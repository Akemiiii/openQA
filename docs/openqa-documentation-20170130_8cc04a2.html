<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="openQA Team">
<title>openQA Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>openQA Documentation</h1>
<div class="details">
<span id="author" class="author">openQA Team</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_openqa_starter_guide">openQA starter guide</a>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_architecture">Architecture</a></li>
<li><a href="#_basic_concepts">Basic concepts</a>
<ul class="sectlevel2">
<li><a href="#concepts">Glossary</a></li>
<li><a href="#_jobs">Jobs</a></li>
<li><a href="#_needles">Needles</a></li>
<li><a href="#_interactive_mode">Interactive mode</a></li>
<li><a href="#_access_management">Access management</a></li>
<li><a href="#_job_groups">Job groups</a></li>
<li><a href="#_cleanup">Cleanup</a></li>
</ul>
</li>
<li><a href="#_using_the_client_script">Using the client script</a></li>
<li><a href="#_using_job_templates_to_automate_jobs_creation">Using job templates to automate jobs creation</a>
<ul class="sectlevel2">
<li><a href="#job_templates">The problem</a></li>
<li><a href="#_medium_types_products">Medium Types (products)</a></li>
<li><a href="#_test_suites">Test Suites</a></li>
<li><a href="#_machines">Machines</a></li>
<li><a href="#_variable_expansion">Variable expansion</a></li>
<li><a href="#_variable_precedence">Variable precedence</a></li>
</ul>
</li>
<li><a href="#_testing_opensuse_or_fedora">Testing openSUSE or Fedora</a>
<ul class="sectlevel2">
<li><a href="#_getting_tests">Getting tests</a></li>
<li><a href="#_getting_openqa_configuration">Getting openQA configuration</a></li>
<li><a href="#_adding_a_new_iso_to_test">Adding a new ISO to test</a></li>
</ul>
</li>
<li><a href="#_pitfalls">Pitfalls</a></li>
</ul>
</li>
<li><a href="#_openqa_installation_guide">openQA installation guide</a>
<ul class="sectlevel1">
<li><a href="#_introduction_2">Introduction</a></li>
<li><a href="#_installation">Installation</a></li>
<li><a href="#_basic_configuration">Basic configuration</a>
<ul class="sectlevel2">
<li><a href="#_apache_proxy">Apache proxy</a></li>
<li><a href="#_tls_ssl">TLS/SSL</a></li>
</ul>
</li>
<li><a href="#_run_the_web_ui">Run the web UI</a></li>
<li><a href="#_run_workers">Run workers</a></li>
<li><a href="#_where_to_now">Where to now?</a></li>
<li><a href="#_advanced_configuration">Advanced configuration</a>
<ul class="sectlevel2">
<li><a href="#advanced">User authentication</a></li>
<li><a href="#_openid">OpenID</a></li>
<li><a href="#_ichain">iChain</a></li>
<li><a href="#_fake">Fake</a></li>
<li><a href="#_setting_up_git_support">Setting up git support</a></li>
<li><a href="#_referer_settings_to_auto_mark_important_jobs">Referer settings to auto-mark important jobs</a></li>
<li><a href="#_worker_settings">Worker settings</a></li>
<li><a href="#_configuring_remote_workers">Configuring remote workers</a></li>
<li><a href="#_configuring_worker_to_use_more_than_one_openqa_server">Configuring worker to use more than one openQA server</a></li>
<li><a href="#_needle_caching">Needle Caching</a></li>
</ul>
</li>
<li><a href="#_auditing_tracking_openqa_changes">Auditing - tracking openQA changes</a>
<ul class="sectlevel2">
<li><a href="#_list_of_events_tracked_by_the_auditing_plugin">List of events tracked by the auditing plugin:</a></li>
</ul>
</li>
<li><a href="#_filesystem_layout">Filesystem Layout</a></li>
<li><a href="#_other_database_engines">Other database engines</a>
<ul class="sectlevel2">
<li><a href="#_example_for_connecting_to_local_postgresql_database">Example for connecting to local PostgreSQL database</a></li>
<li><a href="#_example_for_connecting_to_remote_postgresql_database">Example for connecting to remote PostgreSQL database</a></li>
<li><a href="#_general_notes">General notes</a></li>
<li><a href="#_changing_the_database_engine">Changing the database engine</a></li>
</ul>
</li>
<li><a href="#_troubleshooting">Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#troubleshooting">Tests fail quickly</a></li>
<li><a href="#_kvm_doesn_t_work">KVM doesn&#8217;t work</a></li>
<li><a href="#_openid_login_times_out">openid login times out</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_openqa_users_guide">openQA users guide</a>
<ul class="sectlevel1">
<li><a href="#_introduction_3">Introduction</a></li>
<li><a href="#_use_of_the_web_interface">Use of the web interface</a>
<ul class="sectlevel2">
<li><a href="#__tests_overview_customizable_test_overview_page">/tests/overview - Customizable test overview page</a></li>
<li><a href="#_description_of_test_suites">Description of test suites</a></li>
<li><a href="#_review_badges">Review badges</a>
<ul class="sectlevel3">
<li><a href="#_meaning_of_the_different_colors">Meaning of the different colors</a></li>
</ul>
</li>
<li><a href="#_build_tagging">Build tagging</a>
<ul class="sectlevel3">
<li><a href="#_tag_builds_with_special_comments_on_group_overview">Tag builds with special comments on group overview</a></li>
<li><a href="#_keeping_important_builds">Keeping important builds</a></li>
</ul>
</li>
<li><a href="#_filtering_test_results_and_builds">Filtering test results and builds</a></li>
<li><a href="#_highlighting_job_dependencies_in_all_tests_table">Highlighting job dependencies in 'All tests' table</a></li>
</ul>
</li>
<li><a href="#_use_of_the_rest_api">Use of the REST API</a></li>
<li><a href="#_where_to_now_2">Where to now?</a></li>
</ul>
</li>
<li><a href="#_openqa_tests_developer_guide">openQA tests developer guide</a>
<ul class="sectlevel1">
<li><a href="#_introduction_4">Introduction</a></li>
<li><a href="#_basic">Basic</a></li>
<li><a href="#_api">API</a></li>
<li><a href="#_how_to_write_tests">How to write tests</a>
<ul class="sectlevel2">
<li><a href="#_test_case_examples">Test Case Examples</a></li>
</ul>
</li>
<li><a href="#_variables">Variables</a></li>
<li><a href="#_test_development_tricks">Test Development tricks</a>
<ul class="sectlevel2">
<li><a href="#_modifying_setting_of_an_existing_test">Modifying setting of an existing test</a></li>
<li><a href="#_using_snapshots_to_speed_up_development_of_tests">Using snapshots to speed up development of tests</a>
<ul class="sectlevel3">
<li><a href="#_enable_snapshots_for_each_module">Enable snapshots for each module</a></li>
<li><a href="#_storing_only_the_last_sucessfull_snapshot">Storing only the last sucessfull snapshot</a></li>
</ul>
</li>
<li><a href="#_assigning_jobs_to_workers">Assigning jobs to workers</a></li>
<li><a href="#_writing_multi_machine_tests">Writing multi-machine tests</a>
<ul class="sectlevel3">
<li><a href="#_job_dependencies">Job dependencies</a></li>
<li><a href="#_openqa_worker_requirements">OpenQA worker requirements</a>
<ul class="sectlevel4">
<li><a href="#_examples">Examples:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_test_synchronization_and_locking_api">Test synchronization and locking API</a></li>
<li><a href="#_support_server_based_tests">Support Server based tests</a>
<ul class="sectlevel3">
<li><a href="#_preparing_the_supportserver">Preparing the supportserver:</a></li>
<li><a href="#_using_the_supportserver">Using the supportserver:</a></li>
</ul>
</li>
<li><a href="#_using_text_consoles_and_the_serial_terminal">Using text consoles and the serial terminal</a>
<ul class="sectlevel3">
<li><a href="#_using_a_serial_terminal">Using a serial terminal</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_openqa_pitfalls">openQA pitfalls</a>
<ul class="sectlevel1">
<li><a href="#_needle_editing">Needle editing</a></li>
<li><a href="#_mixed_production_and_development_environment">Mixed production and development environment</a></li>
</ul>
</li>
<li><a href="#_networking_in_openqa">Networking in OpenQA</a>
<ul class="sectlevel1">
<li><a href="#_qemu_user_networking">Qemu user networking</a></li>
<li><a href="#_tap_based_network">TAP based network</a></li>
<li><a href="#_tap_with_open_vswitch">TAP with Open vSwitch</a></li>
<li><a href="#_debugging_open_vswitch_configuration">Debugging Open vSwitch configuration</a></li>
<li><a href="#_vde_based_network">VDE Based Network</a>
<ul class="sectlevel2">
<li><a href="#_basic_single_machine_tests">Basic, single machine tests</a></li>
<li><a href="#_multi_machine_tests">Multi machine tests</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_openqa_developer_guide">openQA developer guide</a>
<ul class="sectlevel1">
<li><a href="#_introduction_5">Introduction</a></li>
<li><a href="#_development_guidelines">Development guidelines</a>
<ul class="sectlevel2">
<li><a href="#_rules_for_commits">Rules for commits</a></li>
</ul>
</li>
<li><a href="#_getting_involved_into_development">Getting involved into development</a></li>
<li><a href="#_technologies">Technologies</a></li>
<li><a href="#_managing_the_database">Managing the database</a>
<ul class="sectlevel2">
<li><a href="#_how_to_change_the_database_schema">How to change the database schema</a></li>
<li><a href="#_how_to_add_fixtures_to_the_database">How to add fixtures to the database</a></li>
</ul>
</li>
<li><a href="#_how_to_overwrite_config_files">How to overwrite config files</a></li>
<li><a href="#_how_to_setup_postgresql_to_test_locally_with_production_data">How to setup PostgreSQL to test locally with production data</a></li>
<li><a href="#_adding_new_authentication_module">Adding new authentication module</a></li>
<li><a href="#_customize_base_directory">Customize base directory</a></li>
</ul>
</li>
<li><a href="#_openqa_branding">openQA branding</a>
<ul class="sectlevel1">
<li><a href="#_web_ui_template">Web UI template</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<h1 id="_openqa_starter_guide" class="sect0">openQA starter guide</h1>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openQA is an automated test tool that makes it possible to test the whole
installation process of an operating system. It uses virtual machines to
reproduce the process, check the output (both serial console and
screen) in every step and send the necessary keystrokes and commands to
proceed to the next. openQA can check whether the system can be installed,
whether it works properly in 'live' mode, whether applications work
or whether the system responds as expected to different installation options and
commands.</p>
</div>
<div class="paragraph">
<p>Even more importantly, openQA can run several combinations of tests for every
revision of the operating system, reporting the errors detected for each
combination of hardware configuration, installation options and variant of the
operating system.</p>
</div>
<div class="paragraph">
<p>openQA is free software released under the
<a href="http://www.gnu.org/licenses/gpl-2.0.html">GPLv2 license</a>. The source code and
documentation are hosted in the <a href="https://github.com/os-autoinst">os-autoinst
organization on GitHub</a>.</p>
</div>
<div class="paragraph">
<p>This document describes the general operation and usage of openQA. The main goal
is to provide a general overview of the tool, with all the information needed to
become a happy user. More advanced topics like installation, administration or
development of new tests are covered by further documents available in the
<a href="https://github.com/os-autoinst/openQA">official repository</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture">Architecture</h2>
<div class="sectionbody">
<div id="architecture" class="paragraph">
<p>Although the project as a whole is referred to as openQA, there are in fact
several components that are hosted in separate repositories as shown in
<a href="#arch_img">the following figure</a>.</p>
</div>
<div id="arch_img" class="imageblock">
<div class="content">
<img src="images/openqa_architecture.png" alt="openQA architecture">
</div>
<div class="title">Figure 1. openQA architecture</div>
</div>
<div class="paragraph">
<p>The heart of the test engine is a standalone application called
'os-autoinst' (blue). In each execution, this application creates a
virtual machine and uses it to run a set of test scripts (red).
'os-autoinst' generates a video, screenshots and a JSON file with
detailed results.</p>
</div>
<div class="paragraph">
<p>'openQA' (green) on the other hand provides a web based user
interface and infrastructure to run 'os-autoinst' in a distributed
way. The web interface also provides a JSON based REST-like API for
external scripting and for use by the worker program. Workers
fetch data and input files from openQA for os-autoinst to run the
tests. A host system can run several workers. The openQA web
application takes care of distributing test jobs among workers. Web
application and workers don&#8217;t have to run on the same machine but
can be connected via network instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_concepts">Basic concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concepts">Glossary</h3>
<div class="hdlist">
<div class="title">The following terms are used within the context of openQA</div>
<table>
<tr>
<td class="hdlist1">
test modules
</td>
<td class="hdlist2">
<p>an individual test case in a single perl module file, e.g.
"sshxterm". If not further specified a test module is denoted with its "short
name" equivalent to the filename including the test definition. The "full name"
is composed of the <em>test group</em> (TBC), which itself is formed by the top-folder
of the test module file, and the short name, e.g. "x11-sshxterm" (for
x11/sshxterm.pm)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
test suite
</td>
<td class="hdlist2">
<p>a collection of <em>test modules</em>, e.g. "textmode". All <em>test
modules</em> within one <em>test suite</em> are run serially</p>
</td>
</tr>
<tr>
<td class="hdlist1">
job
</td>
<td class="hdlist2">
<p>one run of individual test cases in a row denoted by a unique number for
one instance of openQA, e.g. one installation with subsequent testing of
applications within gnome</p>
</td>
</tr>
<tr>
<td class="hdlist1">
test run
</td>
<td class="hdlist2">
<p>equivalent to <em>job</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
test result
</td>
<td class="hdlist2">
<p>the result of one job, e.g. "passed" with the details of each
individual <em>test module</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
test step
</td>
<td class="hdlist2">
<p>the execution of one <em>test module</em> within a <em>job</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
distri
</td>
<td class="hdlist2">
<p>a test distribution but also sometimes referring to a <em>product</em>
(CAUTION: ambiguous, historically a "GNU/Linux distribution"), composed of
multiple <em>test modules</em> in a folder structure that compose <em>test suites</em>, e.g.
"opensuse" (test distribution, short for "os-autoinst-distri-opensuse")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
product
</td>
<td class="hdlist2">
<p>the main "system under test" (SUT), e.g. "openSUSE"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
job group
</td>
<td class="hdlist2">
<p>equivalent to <em>product</em>, used in context of the webUI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
version
</td>
<td class="hdlist2">
<p>one version of a <em>product</em>, don&#8217;t confuse with <em>builds</em>, e.g.
"Tumbleweed"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
flavor
</td>
<td class="hdlist2">
<p>a specific variant of a <em>product</em> to distinguish differing variants,
e.g. "DVD"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
arch
</td>
<td class="hdlist2">
<p>an architecture variant of a <em>product</em>, e.g. "x86_64"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
machine
</td>
<td class="hdlist2">
<p>additional variant of machine, e.g. used for "64bit", "uefi", etc.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
scenario
</td>
<td class="hdlist2">
<p>A composition of
&lt;distri&gt;-&lt;version&gt;-&lt;flavor&gt;-&lt;arch&gt;-&lt;test_suite&gt;@&lt;machine&gt;, e.g.
"openSUSE-Tumbleweed-DVD-x86_64-gnome@64bit", nicknamed <em>koala</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
build
</td>
<td class="hdlist2">
<p>Different versions of a product as tested, can be considered a
"sub-version" of <em>version</em>, e.g. "Build1234"; <strong>CAUTION:</strong> ambiguity: either with
the prefix "Build" included or not</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jobs">Jobs</h3>
<div class="paragraph">
<p>One of the most important features of openQA is that it can be used to test
several combinations of actions and configurations. For every one of those
combinations, the system creates a virtual machine, performs certain steps and
returns an overall result. Every one of those executions is called a 'job'.
Every job is labeled with a numeric identifier and has several associated
'settings' that will drive its behavior.</p>
</div>
<div class="paragraph">
<p>A job goes through several states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scheduled</strong> Initial state for recently created jobs. Queued for future
execution.</p>
</li>
<li>
<p><strong>running</strong> In progress.</p>
</li>
<li>
<p><strong>cancelled</strong> The job was explicitly cancelled by the user or was replaced by a
clone (see below).</p>
</li>
<li>
<p><strong>waiting</strong> The job is in 'interactive mode' (see below) and waiting for input.</p>
</li>
<li>
<p><strong>done</strong> Execution finished.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jobs in state 'done' have typically gone through a whole sequence of steps
(called 'testmodules') each one with its own result. But in addition to those
partial results, a finished job also provides an overall result from the
following list.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong> For jobs that have not reached the 'done' state.</p>
</li>
<li>
<p><strong>passed</strong> No critical check failed during the process. It doesn&#8217;t necessarily
mean that all testmodules were successful or that no single assertion failed.</p>
</li>
<li>
<p><strong>failed</strong> At least one assertion considered to be critical was not satisfied at some
point.</p>
</li>
<li>
<p><strong>softfailed</strong> At least one non-critical assertion was not satisfied at some
point (eg. a softfailure has been recorded explicitly via record_soft_failure)
or workaround needles are in place.</p>
</li>
<li>
<p><strong>incomplete</strong> The job is no longer running but no result was provided. Either
it was cancelled while running or it crashed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sometimes, the reason of a failure is not an error in the tested operating system
itself, but an outdated test or a problem in the execution of the job for some
external reason. In those situations, it makes sense to re-run a given job from
the beginning once the problem is fixed or the tests have been updated.
This is done by means of 'cloning'. Every job can be superseded by a clone which
is scheduled to run with exactly the same settings as the original job. If the
original job is still not in 'done' state, it&#8217;s cancelled immediately.
From that point in time, the clone becomes the current version and the original
job is considered outdated (and can be filtered in the listing) but its
information and results (if any) are kept for future reference.</p>
</div>
</div>
<div class="sect2">
<h3 id="_needles">Needles</h3>
<div class="paragraph">
<p>One of the main mechanisms for openQA to know the state of the virtual machine
is checking the presence of some elements in the machine&#8217;s 'screen'.
This is performed using fuzzy image matching between the screen and the so
called 'needles'. A needle specifies both the elements to search for and a
list of tags used to decide which needles should be used at any moment.</p>
</div>
<div class="paragraph">
<p>A needle consists of a full screenshot in PNG format and a json file with
the same name (e.g. foo.png and foo.json) containing the associated data, like
which areas inside the full screenshot are relevant or the mentioned list of
tags.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
   <span class="tok-nt">&quot;area&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;xpos&quot;</span> <span class="tok-p">:</span> <span class="tok-err">INTEGER</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;ypos&quot;</span> <span class="tok-p">:</span> <span class="tok-err">INTEGER</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;width&quot;</span> <span class="tok-p">:</span> <span class="tok-err">INTEGER</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;height&quot;</span> <span class="tok-p">:</span> <span class="tok-err">INTEGER</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-err">(</span> <span class="tok-s2">&quot;match&quot;</span> <span class="tok-err">|</span> <span class="tok-s2">&quot;ocr&quot;</span> <span class="tok-err">|</span> <span class="tok-s2">&quot;exclude&quot;</span> <span class="tok-err">)</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;match&quot;</span> <span class="tok-p">:</span> <span class="tok-err">INTEGER</span><span class="tok-p">,</span> <span class="tok-err">//</span> <span class="tok-err">0-100.</span> <span class="tok-err">similarity</span> <span class="tok-err">percentage</span>
      <span class="tok-p">},</span>
      <span class="tok-err">...</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;tags&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-err">STRING</span><span class="tok-p">,</span> <span class="tok-err">...</span>
   <span class="tok-p">]</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interactive_mode">Interactive mode</h3>
<div class="paragraph">
<p>There are several points in time during the execution of a job at which openQA
tries to match the screen with the available needles, reacting to the result of
that check. If the job is running in interactive mode it will stop the execution
at that point, freezing the virtual machine and waiting for user input before
proceeding. At that moment, the user can modify the existing needles or can
create a new one using as a starting point either the current screen of the
virtual machine or one of the existing needles. Once the needles are adjusted,
the user can command the job to reload the list of needles and continue with the
execution.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>enable interactive mode</strong> Get into waiting for input automatically (ie. waitforneedle)
in case it can not find the matched needle and timeout.</p>
</li>
<li>
<p><strong>stop waiting for needle</strong> Stop the waitforneedle call immediately without timeout.</p>
</li>
<li>
<p><strong>continue waiting for needle</strong> Continue testing but will get into waitforneedle
in case it can not find the matched needle and timeout.</p>
</li>
<li>
<p><strong>reload needles and retry</strong> Retries after 5 seconds and reloads needles. It helps if
a new needle is created before retry.</p>
</li>
<li>
<p><strong>open needle editor</strong> Opens needle editor so the user can create a new needle or
modify the existing ones.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The interactive mode is especially useful when creating needles for a new
operating system or when the look &amp; feel have changed and several needles need
to be adjusted accordingly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_access_management">Access management</h3>
<div class="paragraph">
<p>Some actions in openQA require special privileges. openQA provides
authentication through <a href="http://en.wikipedia.org/wiki/OpenID">openID</a>. By default,
openQA is configured to use the openSUSE openID provider, but it can very
easily be configured to use any other valid provider. Every time a new user logs
into an instance, a new user profile is created. That profile only
contains the openID identity and two flags used for access control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>operator</strong> Means that the user is able to manage jobs, performing actions like
creating new jobs, cancelling them, etc.</p>
</li>
<li>
<p><strong>admin</strong> Means that the user is able to manage users (granting or revoking
operator and admin rights) as well as job templates and other related
information (see the <a href="#job_templates">the corresponding section</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many of the operations in an openQA instance are not performed through the web
interface but using the REST-like API. The most obvious examples are the
workers and the scripts that fetch new versions of the operating system and
schedule the corresponding tests. Those clients must be authorized by an
operator using an
<a href="http://en.wikipedia.org/wiki/Application_programming_interface_key">API key</a> with
an associated shared secret.</p>
</div>
<div class="paragraph">
<p>For that purpose, users with the operator flag have access in the web interface
to a page that allows them to manage as many API keys as they may need. For every
key, a secret is automatically generated. The user can then configure the
workers or any other client application to use whatever pair of API key and
secret owned by him. Any client to the REST-like API using one of those API keys
will be considered to be acting on behalf of the associated user. So the API key
not only has to be correct and valid (not expired), it also has to belong to a
user with operator rights.</p>
</div>
<div class="paragraph">
<p>For more insights about authentication, authorization and the technical details
of the openQA security model, refer to the
<a href="http://lizards.opensuse.org/2014/02/28/about-openqa-and-authentication/">detailed
blog post</a> about the subject by the openQA development team.</p>
</div>
</div>
<div class="sect2">
<h3 id="_job_groups">Job groups</h3>
<div class="paragraph">
<p>A job can belong to a job group. Those job groups are displayed on the index page
and in the Job Groups menu on the navigation bar. From there the job group overview
pages can be accessed. Besides the test results the job group overview pages provide
a description about the job group and allow commenting.</p>
</div>
<div class="paragraph">
<p>Job groups have properties. These properties are mostly cleanup related. The
configuration can be done in the operators menu for job groups.</p>
</div>
<div class="paragraph">
<p>It is also possible to put job groups into categories. The nested groups will then
inherit properties from the category. The categories are meant to combine job groups
with common builds so test results for the same build can be shown together on
the index page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cleanup">Cleanup</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
openQA automatically deletes data that it considers "old" based on
different settings. For example job data is deleted from old jobs by the gru task.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following cleanup settings can be done on job-group-level:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
size limit
</td>
<td class="hdlist2">
<p>Limits size of assets</p>
</td>
</tr>
<tr>
<td class="hdlist1">
keep logs for
</td>
<td class="hdlist2">
<p>Specifies how long logs of a non-important job are retained after
it finished</p>
</td>
</tr>
<tr>
<td class="hdlist1">
keep important logs for
</td>
<td class="hdlist2">
<p>How long logs of an important job are retained after it
finished</p>
</td>
</tr>
<tr>
<td class="hdlist1">
keep results for
</td>
<td class="hdlist2">
<p>specifies How long results of a non-important job are retained
after it finished</p>
</td>
</tr>
<tr>
<td class="hdlist1">
keep important results for
</td>
<td class="hdlist2">
<p>How long results of an important job are retained after
it finished</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The defaults for those values are defined in
<a href="https://github.com/os-autoinst/openQA/blob/master/lib/OpenQA/Schema/JobGroupDefaults.pm">lib/OpenQA/Schema/JobGroupDefaults.pm</a>.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> Deletion of job results includes deletion of logs and will cause the job to
be completely removed from the database.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> Jobs which do not belong to a job group are currently not affected by
the mentioned cleanup properties.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_client_script">Using the client script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just as the worker uses an API key+secret every user of the client script
must do the same. The same API key+secret as previously created can be used or
a new one created over the webUI.</p>
</div>
<div class="paragraph">
<p>The personal configuration should be stored in a file
<code>~/.config/openqa/client.conf</code> in the same format as previously described for
the client.conf, i.e. sections for each machine, e.g. <code>localhost</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_job_templates_to_automate_jobs_creation">Using job templates to automate jobs creation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="job_templates">The problem</h3>
<div class="paragraph">
<p>When testing an operating system, especially when doing continuous testing,
there is always a certain combination of jobs, each one with its own
settings, that needs to be run for every revision. Those combinations can be
different for different 'flavors' of the same revision, like running a different
set of jobs for each architecture or for the Full and the Lite versions. This
combinational problem can go one step further if openQA is being used for
different kinds of tests, like running some simple pre-integration tests
for some snapshots combined with more comprehensive post-integration tests for
release candidates.</p>
</div>
<div class="paragraph">
<p>This section describes how an instance of openQA can be configured using the
options in the admin area to automatically create all the required jobs for each
revision of your operating system that needs to be tested. If you are starting
from scratch, you should probably go through the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define machines in 'Machines' menu</p>
</li>
<li>
<p>Define medium types (products) you have in 'Medium Types' menu</p>
</li>
<li>
<p>Specify various collections of tests you want to run in the 'Test suites'
menu</p>
</li>
<li>
<p>Go to the template matrix in 'Job templates' menu and decide what
combinations do make sense and need to be tested</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Machines, mediums and test suites can all set various configuration variables.
Job templates define how the test suites, mediums and machines should be
combined in various ways to produce individual 'jobs'. All the variables
from the test suite, medium and machine for the 'job' are combined and made
available to the actual test code run by the 'job', along with variables
specified as part of the job creation request. Certain variables also influence
openQA&#8217;s and/or os-autoinst&#8217;s own behavior in terms of how it configures the
environment for the job. Variables that influence os-autoinst&#8217;s behavior
are documented in the file doc/backend_vars.asciidoc in the os-autoinst
repository.</p>
</div>
<div class="paragraph">
<p>In openQA we can parametrize a test to describe for what product it will
run and for what kind of machines it will be executed. For example, a
test like KDE can be run for any product that has KDE installed, and
can be tested in x86-64 and i586 machines. If we write this as a
triples, we can create a list like this to characterize KDE tests:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(Product,             Test Suite, Machine)
(openSUSE-DVD-x86_64, KDE,        64bit)
(openSUSE-DVD-x86_64, KDE,        Laptop-64bit)
(openSUSE-DVD-x86_64, KDE,        USBBoot-64bit)
(openSUSE-DVD-i586,   KDE,        32bit)
(openSUSE-DVD-i586,   KDE,        Laptop-32bit)
(openSUSE-DVD-x86_64, KDE,        USBBoot-32bit)
(openSUSE-DVD-i586,   KDE,        64bit)
(openSUSE-DVD-i586,   KDE,        Laptop-64bit)
(openSUSE-DVD-x86_64, KDE,        USBBoot-64bit)</pre>
</div>
</div>
<div class="paragraph">
<p>For every triplet, we need to configure a different instance of
os-autoinst with a different set of parameters.</p>
</div>
</div>
<div class="sect2">
<h3 id="_medium_types_products">Medium Types (products)</h3>
<div class="paragraph">
<p>A medium type (product) in openQA is a simple description without any concrete
meaning. It basically consists of a name and a set of variables that
define or characterize this product in os-autoinst.</p>
</div>
<div class="paragraph">
<p>Some example variables used by openSUSE are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ISO_MAXSIZE contains the maximum size of the product. There is a
test that checks that the current size of the product is less or
equal than this variable.</p>
</li>
<li>
<p>DVD if it is set to 1, this indicates that the medium is a DVD.</p>
</li>
<li>
<p>LIVECD if it is set to 1, this indicates that the medium is a live
image (can be a CD or USB)</p>
</li>
<li>
<p>GNOME this variable, if it is set to 1, indicates that it is a GNOME
only distribution.</p>
</li>
<li>
<p>PROMO marks the promotional product.</p>
</li>
<li>
<p>RESCUECD is set to 1 for rescue CD images.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_test_suites">Test Suites</h3>
<div class="paragraph">
<p>This is the form where we define the different tests that we created
for openQA. A test consists of a name, a priority (used in the
scheduler to choose the next job) and a set of variables that are used
inside this particular test.</p>
</div>
<div class="paragraph">
<p>Some sample variables used by openSUSE are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BTRFS if set, the file system will be BtrFS.</p>
</li>
<li>
<p>DESKTOP possible values are 'kde' 'gnome' 'lxde' 'xfce' or
'textmode'. Used to indicate the desktop selected by the user during
the test.</p>
</li>
<li>
<p>DOCRUN used for documentation tests.</p>
</li>
<li>
<p>DUALBOOT dual boot testing, needs HDD_1 and HDDVERSION.</p>
</li>
<li>
<p>ENCRYPT encrypt the home directory via YaST.</p>
</li>
<li>
<p>HDDVERSION used together with HDD_1 to set the operating system
previously installed on the hard disk.</p>
</li>
<li>
<p>INSTALLONLY only basic installation.</p>
</li>
<li>
<p>INSTLANG installation language. Actually used only in documentation
tests.</p>
</li>
<li>
<p>LIVETEST the test is on a live medium, do not install the distribution.</p>
</li>
<li>
<p>LVM select LVM volume manager.</p>
</li>
<li>
<p>NICEVIDEO used for rendering a result video for use in show rooms,
skipping ugly and boring tests.</p>
</li>
<li>
<p>NOAUTOLOGIN unmark autologin in YaST</p>
</li>
<li>
<p>NUMDISKS total number of disks in QEMU.</p>
</li>
<li>
<p>REBOOTAFTERINSTALL if set to 1, will reboot after the installation.</p>
</li>
<li>
<p>SCREENSHOTINTERVAL used with NICEVIDEO to improve the video quality.</p>
</li>
<li>
<p>SPLITUSR a YaST configuration option.</p>
</li>
<li>
<p>TOGGLEHOME a YaST configuration option.</p>
</li>
<li>
<p>UPGRADE upgrade testing, need HDD_1 and HDDVERSION.</p>
</li>
<li>
<p>VIDEOMODE if the value is 'text', the installation will be done in
text mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of the variables usually set in test suites that influence openQA
and/or os-autoinst&#8217;s own behavior are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HDDMODEL variable to set the HDD hardware model</p>
</li>
<li>
<p>HDDSIZEGB hard disk size in GB. Used together with BtrFS variable</p>
</li>
<li>
<p>HDD_1 path for the pre-created hard disk</p>
</li>
<li>
<p>RAIDLEVEL RAID configuration variable</p>
</li>
<li>
<p>QEMUVGA parameter to declare the video hardware configuration in QEMU</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_machines">Machines</h3>
<div class="paragraph">
<p>You need to have at least one machine set up to be able to run any
tests. Those machines represent virtual machine types that you want to
test. To make tests actually happen, you have to have an 'openQA
worker' connected that can fulfill those specifications.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name.</strong> User defined string - only needed for operator to identify the machine
configuration.</p>
</li>
<li>
<p><strong>Backend.</strong> What backend should be used for this machine. Recommended value is
qemu as it is the most tested one, but other options (such as kvm2usb or vbox)
are also possible.</p>
</li>
<li>
<p><strong>Variables</strong> Most machine variables influence os-autoinst&#8217;s behavior in terms
of how the test machine is set up. A few important examples:</p>
<div class="ulist">
<ul>
<li>
<p>QEMUCPU can be 'qemu32' or 'qemu64' and specifies the architecture of the
virtual CPU.</p>
</li>
<li>
<p>QEMUCPUS is an integer that specifies the number of cores you wish for.</p>
</li>
<li>
<p>LAPTOP if set to 1, QEMU will create a laptop profile.</p>
</li>
<li>
<p>USBBOOT when set to 1, the image will be loaded through an
emulated USB stick.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_variable_expansion">Variable expansion</h3>
<div class="paragraph">
<p>Any variable defined in Test Suite, Machine or Product table can refer to another
variable using this syntax: %NAME%. When the test job is created, the string
will be substituted with the value of the specified variable at that time.</p>
</div>
<div class="paragraph">
<p>For example this variable defined for Test Suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-nv">PUBLISH_HDD_1</span> <span class="tok-o">=</span> %DISTRI%-%VERSION%-%ARCH%-%DESKTOP%.qcow2</code></pre>
</div>
</div>
<div class="paragraph">
<p>may be expanded to this job variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-nv">PUBLISH_HDD_1</span> <span class="tok-o">=</span> opensuse-13.1-i586-kde.qcow2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_variable_precedence">Variable precedence</h3>
<div class="paragraph">
<p>It&#8217;s possible to define the same variable in multiple places that would all be
used for a single job - for instance, you may have a variable defined in both
a test suite and a product that appear in the same job template. The precedence
order for variables is as follows (from lowest to highest):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Product</p>
</li>
<li>
<p>Machine</p>
</li>
<li>
<p>Test suite</p>
</li>
<li>
<p>API POST query parameters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That is, variable values set as part of the API request that triggers the jobs will
'win' over values set at any of the other locations.</p>
</div>
<div class="paragraph">
<p>If you need to override this precedence - for example, you want the value set in
one particular test suite to take precedence over a setting of the same value from
the API request - you can add a leading + to the variable name. For instance, if
you set +VARIABLE = foo in a test suite, and passed VARIABLE=bar in the API
request, the test suite setting would 'win' and the value would be foo.</p>
</div>
<div class="paragraph">
<p>If the same variable is set with a + prefix in multiple places, the same precedence
order described above will apply to those settings.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_opensuse_or_fedora">Testing openSUSE or Fedora</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An easy way to start using openQA is to start testing openSUSE or Fedora as they
have everything setup and prepared to ease the initial deployment. If you want
to play deeper, you can configure the whole openQA manually from scratch, but
this document should help you to get started faster.</p>
</div>
<div class="sect2">
<h3 id="_getting_tests">Getting tests</h3>
<div class="paragraph">
<p>First you need to get actual tests. You can get openSUSE tests and needles (the
expected results) from
<a href="https://github.com/os-autoinst/os-autoinst-distri-opensuse">GitHub</a>. It belongs
into the /var/lib/openqa/tests/opensuse directory. To make it easier, you can just
run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">/usr/share/openqa/script/fetchneedles</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will download the tests to the correct location and will set the correct
rights as well.</p>
</div>
<div class="paragraph">
<p>Fedora&#8217;s tests are also in <a href="https://bitbucket.org/rajcze/openqa_fedora">git</a>. To
use them, you may do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-nb">cd</span> /var/lib/openqa/share/tests
mkdir fedora
<span class="tok-nb">cd</span> fedora
git clone https://bitbucket.org/rajcze/openqa_fedora_tools.git
<span class="tok-nb">cd</span> ..
chown -R geekotest fedora/</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getting_openqa_configuration">Getting openQA configuration</h3>
<div class="paragraph">
<p>To get everything configured to actually run the tests, there are plenty of
options to set in the admin interface. If you plan to test openSUSE Factory, using
tests mentioned in the previous section, the easiest way to get started is the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">/var/lib/openqa/share/tests/opensuse/products/opensuse/templates <span class="tok-o">[</span>--apikey API_KEY<span class="tok-o">]</span> <span class="tok-o">[</span>--apisecret API_SECRET<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will load some default settings that were used at some point of time in
openSUSE production openQA. Therefore those should work reasonably well with
openSUSE tests and needles. This script uses /usr/share/openqa/script/load_templates,
consider reading its help page (--help) for documentation on possible extra arguments.</p>
</div>
<div class="paragraph">
<p>For Fedora, similarly, you can call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">/var/lib/openqa/share/tests/fedora/templates <span class="tok-o">[</span>--apikey API_KEY<span class="tok-o">]</span> <span class="tok-o">[</span>--apisecret API_SECRET<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Some Fedora tests require special hard disk images to be present in
/var/lib/openqa/share/factory/hdd/fixed. The createhdds.py script in the
<a href="https://bitbucket.org/rajcze/openqa_fedora_tools.git">openqa_fedora_tools</a>
repository can be used to create these. See the documentation in that repo
for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_new_iso_to_test">Adding a new ISO to test</h3>
<div class="paragraph">
<p>To start testing a new ISO put it in /var/lib/openqa/share/factory/iso and call
the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># Run the first test</span>
/usr/share/openqa/script/client isos post <span class="tok-se">\</span>
         <span class="tok-nv">ISO</span><span class="tok-o">=</span>openSUSE-Factory-NET-x86_64-Build0053-Media.iso <span class="tok-se">\</span>
         <span class="tok-nv">DISTRI</span><span class="tok-o">=</span>opensuse <span class="tok-se">\</span>
         <span class="tok-nv">VERSION</span><span class="tok-o">=</span>Factory <span class="tok-se">\</span>
         <span class="tok-nv">FLAVOR</span><span class="tok-o">=</span>NET <span class="tok-se">\</span>
         <span class="tok-nv">ARCH</span><span class="tok-o">=</span>x86_64 <span class="tok-se">\</span>
         <span class="tok-nv">BUILD</span><span class="tok-o">=</span><span class="tok-m">0053</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your openQA is not running on port 80 on 'localhost', you can add option
--host=http://otherhost:9526 to specify a different port or host.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Use only the ISO filename in the 'client' command. You must place the
file in /var/lib/openqa/share/factory/iso. You cannot place the file elsewhere and
specify its path in the command.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Fedora, a sample run might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># Run the first test</span>
/usr/share/openqa/script/client isos post <span class="tok-se">\</span>
         <span class="tok-nv">ISO</span><span class="tok-o">=</span>Fedora-Everything-boot-x86_64-Rawhide-20160308.n.0.iso <span class="tok-se">\</span>
         <span class="tok-nv">DISTRI</span><span class="tok-o">=</span>fedora <span class="tok-se">\</span>
         <span class="tok-nv">VERSION</span><span class="tok-o">=</span>Rawhide <span class="tok-se">\</span>
         <span class="tok-nv">FLAVOR</span><span class="tok-o">=</span>Everything-boot-iso <span class="tok-se">\</span>
         <span class="tok-nv">ARCH</span><span class="tok-o">=</span>x86_64 <span class="tok-se">\</span>
         <span class="tok-nv">BUILD</span><span class="tok-o">=</span>Rawhide-20160308.n.0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pitfalls">Pitfalls</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Take a look at <a href="Pitfalls.asciidoc">Documented Pitfalls</a>.</p>
</div>
</div>
</div>
<h1 id="_openqa_installation_guide" class="sect0">openQA installation guide</h1>
<div class="sect1">
<h2 id="_introduction_2">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openQA is an automated test tool that makes it possible to test the whole
installation process of an operating system. It&#8217;s free software released
under the <a href="http://www.gnu.org/licenses/gpl-2.0.html">GPLv2 license</a>. The
source code and documentation are hosted in the
<a href="https://github.com/os-autoinst">os-autoinst organization on GitHub</a>.</p>
</div>
<div class="paragraph">
<p>This document provides the information needed to install and setup the tool, as
well as information useful for everyday administration of the system. It&#8217;s
assumed that the reader is already familiar with openQA and has already read the
Starter Guide, available at the
<a href="https://github.com/os-autoinst/openQA">official repository</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to install openQA is from packages. You can find openSUSE
packages in OBS in the
<a href="https://build.opensuse.org/project/show/devel:openQA:stable">openQA:stable</a>
repository.</p>
</div>
<div class="paragraph">
<p>The latest development version can also be found in OBS in the
<a href="https://build.opensuse.org/project/show/devel:openQA">openQA:devel</a> repository.</p>
</div>
<div class="paragraph">
<p>For Fedora, packages are available in the official repositories for Fedora 23
and later. Installation on these distributions is therefore pretty simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># openSUSE Leap 42.2</span>
zypper ar -f obs://devel:openQA/openSUSE_Leap_42.2 openQA
zypper ar -f obs://devel:openQA:Leap:42.2/openSUSE_Leap_42.2 openQA-perl-modules

<span class="tok-c1"># openSUSE Tumbleweed</span>
zypper ar -f obs://devel:openQA/openSUSE_Tumbleweed openQA

<span class="tok-c1"># all openSUSE</span>
zypper in openQA

<span class="tok-c1"># Fedora 23+</span>
dnf install openqa openqa-httpd</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_configuration">Basic configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apache_proxy">Apache proxy</h3>
<div class="paragraph">
<p>It is required to run openQA behind an http proxy (apache, nginx, etc..). See the
openqa.conf.template config file in /etc/apache2/vhosts.d (openSUSE) or
/etc/httpd/conf.d (Fedora). To make everything work correctly on openSUSE, you
need to enable the 'headers', 'proxy', 'proxy_http' and 'proxy_wstunnel' modules
using the command 'a2enmod'. This is not necessary on Fedora. For a basic setup, you can
copy openqa.conf.template to openqa.conf and modify the ServerName
setting. This will direct all HTTP traffic to openQA.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># openSUSE Only</span>
<span class="tok-c1"># You can check what modules are enabled by using &#39;a2enmod -l&#39;</span>
a2enmod headers
a2enmod proxy
a2enmod proxy_http
a2enmod proxy_wstunnel</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tls_ssl">TLS/SSL</h3>
<div class="paragraph">
<p>By default openQA expects to be run with HTTPS. The openqa-ssl.conf.template
Apache config file is available as a base for creating the Apache config; you
can copy it to openqa-ssl.conf and uncomment any lines you like, then
ensure a key and certificate are installed to the appropriate location
(depending on distribution and whether you uncommented the lines for key and
cert location in the config file). If you don&#8217;t have a TLS/SSL certificate for
your host you must turn HTTPS off. You can do that in /etc/openqa/openqa.ini:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[openid]</span>
<span class="tok-na">httpsonly</span> <span class="tok-o">=</span> <span class="tok-s">0</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_the_web_ui">Run the web UI</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">systemctl start openqa-scheduler
systemctl start openqa-gru
systemctl start openqa-websockets
systemctl start openqa-webui
<span class="tok-c1"># openSUSE</span>
systemctl restart apache2
<span class="tok-c1"># Fedora</span>
<span class="tok-c1"># for now this is necessary to allow Apache to connect to openQA</span>
setsebool -P httpd_can_network_connect <span class="tok-m">1</span>
systemctl restart httpd</code></pre>
</div>
</div>
<div class="paragraph">
<p>The openQA web UI should be available on <a href="http://localhost/" class="bare">http://localhost/</a> now. To ensure
openQA runs on each boot, you should also systemctl enable the same services.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">systemctl <span class="tok-nb">enable</span> openqa-scheduler
systemctl <span class="tok-nb">enable</span> openqa-gru
systemctl <span class="tok-nb">enable</span> openqa-websockets
systemctl <span class="tok-nb">enable</span> openqa-webui</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_workers">Run workers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Workers are processes running virtual machines to perform the actual
testing. They are distributed as a separate package and can be installed on
multiple machines but still using only one WebUI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># openSUSE</span>
zypper in openQA-worker
<span class="tok-c1"># Fedora</span>
dnf install openqa-worker</code></pre>
</div>
</div>
<div class="paragraph">
<p>To allow workers to access your instance, you need to log into openQA as
operator and create a pair of API key and secret. Once you are logged in, in the
top right corner, is the user menu, follow the link 'manage API keys'.  Click
the 'create' button to generate key and secret. There is also a script
available for creating an admin user and an API key+secret pair
non-interactively, /usr/share/openqa/script/create_admin, which can be useful
for scripted deployments of openQA. Copy and paste the key and secret into
/etc/openqa/client.conf on the machine(s) where the worker is installed. Make
sure to put in a section reflecting your webserver URL. In the simplest case,
your client.conf may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[localhost]</span>
<span class="tok-na">key</span> <span class="tok-o">=</span> <span class="tok-s">0123456789ABCDEF</span>
<span class="tok-na">secret</span> <span class="tok-o">=</span> <span class="tok-s">0123456789ABCDEF</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To start the workers you can use the provided systemd files via systemctl
start openqa-worker@1. This will start worker number one. You can start as
many workers as you dare, you just need to supply different 'worker id' (number
after @).</p>
</div>
<div class="paragraph">
<p>You can also run workers manually from command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">sudo -u _openqa-worker /usr/share/openqa/script/worker --instance X</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will run a worker manually showing you debug output. If you haven&#8217;t
installed 'os-autoinst' from packages make sure to pass --isotovideo option
to point to the checkout dir where isotovideo is, not to /usr/lib! Otherwise
it will have trouble finding its perl modules.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_to_now">Where to now?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From this point on, you can refer to the <a href="GettingStarted.asciidoc#testing-opensuse-or-fedora">getting started</a> guide to
fetch the tests cases and possibly take a look at <a href="WritingTests.asciidoc">Test Developer Guide</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_configuration">Advanced configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="advanced">User authentication</h3>
<div class="paragraph">
<p>OpenQA supports three different authentication methods - OpenID (default), iChain
and Fake. See auth section in /etc/openqa/openqa.ini.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[auth]</span>
<span class="tok-c1"># method name is case sensitive!</span>
<span class="tok-na">method</span> <span class="tok-o">=</span> <span class="tok-s">OpenID|iChain|Fake</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Independently of method used, the first user that logs in (if there is no admin yet)
will automatically get administrator rights!</p>
</div>
</div>
<div class="sect2">
<h3 id="_openid">OpenID</h3>
<div class="paragraph">
<p>By default openQA uses OpenID with opensuse.org as OpenID provider.
OpenID method has its own openid section in /etc/openqa/openqa.ini:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[openid]</span>
<span class="tok-c1">## base url for openid provider</span>
<span class="tok-na">provider</span> <span class="tok-o">=</span> <span class="tok-s">https://www.opensuse.org/openid/user/</span>
<span class="tok-c1">## enforce redirect back to https</span>
<span class="tok-na">httpsonly</span> <span class="tok-o">=</span> <span class="tok-s">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>OpenQA supports only OpenID version up to 2.0. Newer OpenID-Connect and OAuth is
not supported currently.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ichain">iChain</h3>
<div class="paragraph">
<p>Use only if you use iChain (NetIQ Access Manager) proxy on your hosting server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fake">Fake</h3>
<div class="paragraph">
<p>For development purposes only! Fake authentication bypass any authentication and
automatically allow any login requests as 'Demo user' with administrator privileges
and without password. To ease worker testing, API key and secret is created (or updated)
with validity of one day during login.
You can then use following as /etc/openqa/client.conf:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[localhost]</span>
<span class="tok-na">key</span> <span class="tok-o">=</span> <span class="tok-s">1234567890ABCDEF</span>
<span class="tok-na">secret</span> <span class="tok-o">=</span> <span class="tok-s">1234567890ABCDEF</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you switch authentication method from Fake to any other, review your API keys!
You may be vulnerable for up to a day until Fake API key expires.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_git_support">Setting up git support</h3>
<div class="paragraph">
<p>Editing needles from web can optionally commit new or changed needles
automatically to git. To do so, you need to enable git support by setting</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[global]</span>
<span class="tok-na">scm</span> <span class="tok-o">=</span> <span class="tok-s">git</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>in /etc/openqa/openqa.ini. Once you do so and restart the web interface, openQA will
automatically commit new needles to the git repository.</p>
</div>
<div class="paragraph">
<p>You may want to add some description to automatic commits coming
from the web UI.
You can do so by setting your configuration in the repository
(/var/lib/os-autoinst/needles/.git/config) to some reasonable defaults such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[user]</span>
	<span class="tok-na">email</span> <span class="tok-o">=</span> <span class="tok-s">whatever@example.com</span>
<span class="tok-s">	name = openQA web UI</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable automatic pushing of the repo as well, you need to add the following
to your openqa.ini:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[scm git]</span>
<span class="tok-na">do_push</span> <span class="tok-o">=</span> <span class="tok-s">yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on your setup, you might need to generate and propagate
ssh keys for user 'geekotest' to be able to push.</p>
</div>
</div>
<div class="sect2">
<h3 id="_referer_settings_to_auto_mark_important_jobs">Referer settings to auto-mark important jobs</h3>
<div class="paragraph">
<p>Automatic cleanup of old results (see GRU jobs) can sometimes render important
tests useless. For example bug report with link to openQA job which no longer
exists. Job can be manually marked as important to prevent quick cleanup or
referer can be set so when job is accessed from particular web page (for
example bugzilla), this job is automatically labeled as linked and treated as
important.</p>
</div>
<div class="paragraph">
<p>List of recognized referers is space separated list configured in
/etc/openqa/openqa.ini:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[global]</span>
<span class="tok-na">recognized_referers</span> <span class="tok-o">=</span> <span class="tok-s">bugzilla.suse.com bugzilla.opensuse.org</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_worker_settings">Worker settings</h3>
<div class="paragraph">
<p>Default behavior for all workers is to use the 'Qemu' backend and connect to
'http://localhost'. If you want to change some of those options, you can do so
in /etc/openqa/workers.ini. For example to point the workers to the FQDN of
your host (needed if test cases need to access files of the host) use the
following setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[global]</span>
<span class="tok-na">HOST</span> <span class="tok-o">=</span> <span class="tok-s">http://openqa.example.com</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you got workers running they should show up in the admin section of openQA in
the workers section as 'idle'. When you get so far, you have your own instance
of openQA up and running and all that is left is to set up some tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_remote_workers">Configuring remote workers</h3>
<div class="paragraph">
<p>There are some additional requirements to get remote worker running. First is to
ensure shared storage between openQA WebUI and workers.
Directory /var/lib/openqa/share contains all required data and should be
shared with read-write access across all nodes present in openQA cluster.
This step is intentionally left on system administrator to choose proper shared
storage for her specific needs.</p>
</div>
<div class="paragraph">
<p>Example of NFS configuration:
NFS server is where openQA WebUI is running. Content of /etc/exports</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">/var/lib/openqa/share *<span class="tok-o">(</span><span class="tok-nv">fsid</span><span class="tok-o">=</span><span class="tok-m">0</span>,rw,no_root_squash,sync,no_subtree_check<span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>NFS clients are where openQA workers are running. Run following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">mount -t nfs openQA-webUI-host:/var/lib/openqa/share /var/lib/openqa/share</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_worker_to_use_more_than_one_openqa_server">Configuring worker to use more than one openQA server</h3>
<div class="paragraph">
<p>When there are multiple openQA web interfaces (openQA instances) available a worker
can be configured to register and accept jobs from all of them.</p>
</div>
<div class="paragraph">
<p>Requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/etc/openqa/client.conf must contain API keys and secrets to all instances</p>
</li>
<li>
<p>Shared storage from all instances must be properly mounted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the /etc/openqa/workers.ini enter space-separated instance hosts and optionally
configure where the shared storage is mounted. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[global]</span>
<span class="tok-na">HOSTS</span> <span class="tok-o">=</span> <span class="tok-s">openqa.opensuse.org openqa.fedora.fedoraproject.org</span>

<span class="tok-k">[openqa.opensuse.org]</span>
<span class="tok-na">SHARE_DIRECTORY</span> <span class="tok-o">=</span> <span class="tok-s">/var/lib/openqa/opensuse</span>

<span class="tok-k">[openqa.fedoraproject.org]</span>
<span class="tok-na">SHARE_DIRECTORY</span> <span class="tok-o">=</span> <span class="tok-s">/var/lib/openqa/fedora</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuring SHARE_DIRECTORY is not a hard requirement. Worker will try following
directories prior registering with openQA instance:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SHARE_DIRECTORY</p>
</li>
<li>
<p>/var/lib/openqa/$instance_host</p>
</li>
<li>
<p>/var/lib/openqa/share</p>
</li>
<li>
<p>/var/lib/openqa</p>
</li>
<li>
<p>fail if none of above is available</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once worker registers to openQA instance it checks for available job and starts
accepting websockets commands. Worker accepts jobs as they will come in, there
is no priority, or other ordering, support at the moment.
It is possible to mix local openQA instance with remote instances or use only
remote instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="_needle_caching">Needle Caching</h3>
<div class="paragraph">
<p>If your network is slow or you experience long time to load needles you
might want to consider needle caching. To use needle caching a directory
/var/lib/openqa/cache must be created, and right permissions given to the
'geekotest' user. If you install openQA through the repositories, said directory
will be created for you.</p>
</div>
<div class="paragraph">
<p>In the /etc/openqa/workers.ini</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[global]</span>
<span class="tok-na">CACHEDIRECTORY</span> <span class="tok-o">=</span> <span class="tok-s">/var/lib/openqa/cache</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auditing_tracking_openqa_changes">Auditing - tracking openQA changes</h2>
<div class="sectionbody">
<div id="auditing" class="paragraph">
<p>Auditing plugin enables openQA administrators to maintain overview about what is happening with the system.
Plugin records what event was triggered by whom, when and what the request looked like. Actions done by openQA
workers are tracked under user whose API keys are workers using.</p>
</div>
<div class="paragraph">
<p>Audit log is directly accessible from Admin menu.</p>
</div>
<div class="paragraph">
<p>Auditing, by default enabled, can be disabled by global configuration option in /etc/openqa/openqa.ini:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[global]</span>
<span class="tok-na">audit_enabled</span> <span class="tok-o">=</span> <span class="tok-s">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The audit section of /etc/openqa/openqa.ini allows to exclude some events from logging using
a space separated blacklist:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[audit]</span>
<span class="tok-na">blacklist</span> <span class="tok-o">=</span> <span class="tok-s">job_grab job_done</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_list_of_events_tracked_by_the_auditing_plugin">List of events tracked by the auditing plugin:</h3>
<div class="ulist">
<ul>
<li>
<p>Assets:</p>
<div class="ulist">
<ul>
<li>
<p>asset_register asset_delete</p>
</li>
</ul>
</div>
</li>
<li>
<p>Workers:</p>
<div class="ulist">
<ul>
<li>
<p>worker_register command_enqueue</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jobs:</p>
<div class="ulist">
<ul>
<li>
<p>iso_create iso_delete iso_cancel</p>
</li>
<li>
<p>jobtemplate_create jobtemplate_delete</p>
</li>
<li>
<p>job_create job_grab job_delete job_update_result job_done jobs_restart job_restart job_cancel job_duplicate</p>
</li>
<li>
<p>jobgroup_create jobgroup_connect</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tables:</p>
<div class="ulist">
<ul>
<li>
<p>table_create table_update table_delete</p>
</li>
</ul>
</div>
</li>
<li>
<p>Users:</p>
<div class="ulist">
<ul>
<li>
<p>user_new_comment user_update_comment user_delete_comment user_login</p>
</li>
</ul>
</div>
</li>
<li>
<p>Needles:</p>
<div class="ulist">
<ul>
<li>
<p>needle_delete needle_modify</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of these events are very common and may clutter audit database. For this reason job_grab and job_done
events are blacklisted by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Upgrading openQA does not automatically update /etc/openqa/openqa.ini. Review your configuration after upgrade.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filesystem_layout">Filesystem Layout</h2>
<div class="sectionbody">
<div id="filesystem" class="paragraph">
<p>The openQA web interface can be started via MOJO_REVERSE_PROXY=1 morbo script/openqa in
development mode.</p>
</div>
<div class="paragraph">
<p>/var/lib/openqa/ must be owned by root and contain several sub
directories, most of which must be owned by the user that runs openQA
(default 'geekotest'):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>db contains the sqlite database</p>
</li>
<li>
<p>images is where the server stores test screenshots and thumbnails</p>
</li>
<li>
<p>share contains shared directories for remote workers, can be owned by root</p>
</li>
<li>
<p>share/factory contains test assets and temp directory, can be owned by root but sysadmin must create subdirs</p>
</li>
<li>
<p>share/factory/iso and share/factory/iso/fixed contain ISOs for tests</p>
</li>
<li>
<p>share/factory/hdd and share/factory/hdd/fixed contain hard disk images for tests</p>
</li>
<li>
<p>share/factory/repo and share/factory/repo/fixed contain repositories for tests</p>
</li>
<li>
<p>share/factory/other and share/factory/other/fixed contain miscellaneous test assets (e.g. kernels and initrds)</p>
</li>
<li>
<p>share/factory/tmp is used as a temporary directory (openQA will create it if it owns share/factory)</p>
</li>
<li>
<p>share/tests contains the tests themselves</p>
</li>
<li>
<p>testresults is where the server stores test logs and test-generated assets</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of the asset directories (factory/iso, factory/hdd, factory/repo and
factory/other) may contain a fixed/ subdirectory, and assets of the same
type may be placed in that directory. Placing an asset in the fixed/
subdirectory indicates that it should not be deleted to save space: the GRU
task which removes old assets when the size of all assets for a given job
group is above a specified size will ignore assets in the fixed/
subdirectories.</p>
</div>
<div class="paragraph">
<p>It also contains several symlinks which are necessary due to various things
moving around over the course of openQA&#8217;s development. All the symlinks
can of course be owned by root:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>script (symlink to /usr/share/openqa/script/)</p>
</li>
<li>
<p>tests (symlink to share/tests)</p>
</li>
<li>
<p>factory (symlink to share/factory)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is always best to use the canonical locations, not the compatibility
symlinks - so run scripts from /usr/share/openqa/script, not
/var/lib/openqa/script.</p>
</div>
<div class="paragraph">
<p>You only need the asset directories for the asset types you will actually use,
e.g. if none of your tests refer to openQA-stored repositories, you will need
no factory/repo directory. The distribution packages may not create all
asset directories, so make sure the ones you need are created if necessary.
Packages will likewise usually not contain any tests; you must create your
own tests, or use existing tests for some distribution or other piece of
software.</p>
</div>
<div class="paragraph">
<p>The worker needs to own /var/lib/openqa/pool/$INSTANCE, e.g.
* /var/lib/openqa/pool/1
* /var/lib/openqa/pool/2
* &#8230;&#8203;. - add more if you have more CPUs/disks</p>
</div>
<div class="paragraph">
<p>You can also give the whole pool directory to the _openqa-worker user and let
the workers create their own instance directories.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_database_engines">Other database engines</h2>
<div class="sectionbody">
<div id="otherdb" class="paragraph">
<p>By default, openQA will use an SQLite database: /var/lib/openqa/db/db.sqlite.
This will be automatically created on first access to the openQA web UI, if it
does not exist.</p>
</div>
<div class="paragraph">
<p>It is possible to use PostgreSQL or MariaDB / MySQL instead of SQLite, and
indeed this is recommended for production deployments of openQA. You should
create a database and a dedicated user account with full access to it. To
configure access to the chosen database in openQA, edit /etc/openqa/database.ini
and change the settings in the [production] section.</p>
</div>
<div class="sect2">
<h3 id="_example_for_connecting_to_local_postgresql_database">Example for connecting to local PostgreSQL database</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[production]</span>
<span class="tok-na">dsn</span> <span class="tok-o">=</span> <span class="tok-s">dbi:Pg:dbname=openqa</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_for_connecting_to_remote_postgresql_database">Example for connecting to remote PostgreSQL database</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[production]</span>
<span class="tok-na">dsn</span> <span class="tok-o">=</span> <span class="tok-s">dbi:Pg:dbname=openqa;host=db.example.org</span>
<span class="tok-na">user</span> <span class="tok-o">=</span> <span class="tok-s">openqa</span>
<span class="tok-na">password</span> <span class="tok-o">=</span> <span class="tok-s">somepassword</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_general_notes">General notes</h3>
<div class="paragraph">
<p>The dsn value format technically depends on the database type (though at
time of writing it&#8217;s in fact identical for both supported databases). For
PostgreSQL it&#8217;s documented at <a href="https://metacpan.org/pod/DBD::Pg#DBI-Class-Methods">DBD::Pg</a>,
for MySQL / MariaDB it&#8217;s documented at <a href="https://metacpan.org/pod/DBD::mysql#DBI-Class-Methods">DBD::mysql</a></p>
</div>
<div class="paragraph">
<p>If you intend to use a different database, it is best to create the database
and configuration file before starting the services and connecting to the
web UI for the first time, otherwise openQA will set itself up with an SQLite
database and may get confused when you try to switch to a different one. See
the following section if you want to migrate an existing openQA-on-SQLite
deployment to a different database.</p>
</div>
</div>
<div class="sect2">
<h3 id="_changing_the_database_engine">Changing the database engine</h3>
<div id="dbengine" class="paragraph">
<p>openQA is compatible with several database engines and comes with all the needed
tools to initialize a clean database in any of them. But openQA does not
include tools to migrate the existing data from a database to another. If you
are planning, for example, to leave behind SQLite and switch to PostgreSQL in
your openQA installation, you will need to start with a clean database or
perform the data conversion by yourself.</p>
</div>
<div class="paragraph">
<p>Converting databases from one engine to another is far from trivial. There are
plenty of tools, both commercial and free, that try to address the problem for
different databases and in different ways. The following example SQL scritps are
provided just as a starting point for those willing to migrate from SQLite (the
default engine) to PostgreSQL (successfully backing the biggest openQA
installations at the time of writing). Keep in mind that the scripts will
probably need some previous work, since they are based on the version 22 of the
database schema (likely outdated at the time of reading).</p>
</div>
<div class="paragraph">
<p>First, run this in the SQLite database to dump the database content into a bunch
of CSV files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span class="tok-p">.</span><span class="tok-k">mode</span> <span class="tok-n">csv</span>
<span class="tok-p">.</span><span class="tok-n">header</span> <span class="tok-k">ON</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">assets</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">assets</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">job_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">job_settings</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">machine_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">machine_settings</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">machines</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">machines</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">product_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">product_settings</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">products</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">products</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">secrets</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">secrets</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">test_suite_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">test_suite_settings</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">test_suites</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">test_suites</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">users</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">users</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">worker_properties</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">worker_properties</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">workers</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">workers</span> <span class="tok-k">WHERE</span> <span class="tok-n">id</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">api_keys</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">api_keys</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">job_modules</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">job_modules</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">job_templates</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">job_templates</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">jobs</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">jobs</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">job_dependencies</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">job_dependencies</span><span class="tok-p">;</span>
<span class="tok-p">.</span><span class="tok-k">output</span> <span class="tok-n">jobs_assets</span><span class="tok-p">.</span><span class="tok-n">csv</span>
<span class="tok-k">SELECT</span> <span class="tok-o">*</span> <span class="tok-k">FROM</span> <span class="tok-n">jobs_assets</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, initialize the PostgreSQL database using the standard procedure and
afterwards run this script from the directory containing the CSV files to import
them into the new database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">users</span> <span class="tok-k">FROM</span> <span class="tok-n">users</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">api_keys</span> <span class="tok-k">FROM</span> <span class="tok-n">api_keys</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">secrets</span> <span class="tok-k">FROM</span> <span class="tok-n">secrets</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">assets</span> <span class="tok-k">FROM</span> <span class="tok-n">assets</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">workers</span> <span class="tok-k">FROM</span> <span class="tok-n">workers</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">worker_properties</span> <span class="tok-k">FROM</span> <span class="tok-n">worker_properties</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">products</span> <span class="tok-k">FROM</span> <span class="tok-n">products</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">product_settings</span> <span class="tok-k">FROM</span> <span class="tok-n">product_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">machines</span> <span class="tok-k">FROM</span> <span class="tok-n">machines</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">machine_settings</span> <span class="tok-k">FROM</span> <span class="tok-n">machine_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">test_suites</span> <span class="tok-k">FROM</span> <span class="tok-n">test_suites</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">test_suite_settings</span> <span class="tok-k">FROM</span> <span class="tok-n">test_suite_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">job_templates</span> <span class="tok-k">FROM</span> <span class="tok-n">job_templates</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">jobs</span> <span class="tok-k">FROM</span> <span class="tok-n">jobs</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">job_settings</span> <span class="tok-k">FROM</span> <span class="tok-n">job_settings</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">job_modules</span> <span class="tok-k">FROM</span> <span class="tok-n">job_modules</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">job_dependencies</span> <span class="tok-k">FROM</span> <span class="tok-n">job_dependencies</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-err">\</span><span class="tok-k">copy</span> <span class="tok-n">jobs_assets</span> <span class="tok-k">FROM</span> <span class="tok-n">jobs_assets</span><span class="tok-p">.</span><span class="tok-n">csv</span> <span class="tok-k">WITH</span> <span class="tok-n">csv</span> <span class="tok-n">header</span> <span class="tok-k">NULL</span> <span class="tok-k">AS</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;users_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">users</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;api_keys_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">api_keys</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;secrets_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">secrets</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;assets_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">assets</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;workers_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">workers</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;worker_properties_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">worker_properties</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;products_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">products</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;product_settings_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">product_settings</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;machines_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">machines</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;machine_settings_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">machine_settings</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;test_suites_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">test_suites</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;test_suite_settings_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">test_suite_settings</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;job_templates_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">job_templates</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;jobs_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">jobs</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;job_settings_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">job_settings</span><span class="tok-p">));</span>
<span class="tok-k">SELECT</span> <span class="tok-n">SETVAL</span><span class="tok-p">(</span><span class="tok-s1">&#39;job_modules_id_seq&#39;</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-k">SELECT</span> <span class="tok-k">MAX</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span> <span class="tok-k">FROM</span> <span class="tok-n">job_modules</span><span class="tok-p">));</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="troubleshooting">Tests fail quickly</h3>
<div class="paragraph">
<p>Check the log files in /var/lib/openqa/testresults</p>
</div>
</div>
<div class="sect2">
<h3 id="_kvm_doesn_t_work">KVM doesn&#8217;t work</h3>
<div class="ulist">
<ul>
<li>
<p>make sure you have a machine with kvm support</p>
</li>
<li>
<p>make sure kvm_intel or kvm_amd modules are loaded</p>
</li>
<li>
<p>make sure you do have virtualization enabled in BIOS</p>
</li>
<li>
<p>make sure the '_openqa-worker' user can access /dev/kvm</p>
</li>
<li>
<p>make sure you are not already running other hypervisors such as VirtualBox</p>
</li>
<li>
<p>when running inside a vm make sure nested virtualization is enabled (pass nested=1 to your kvm module)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_openid_login_times_out">openid login times out</h3>
<div class="paragraph">
<p>www.opensuse.org&#8217;s openid provider may have trouble with IPv6. openQA shows a message like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>no_identity_server: Could not determine ID provider from URL.</pre>
</div>
</div>
<div class="paragraph">
<p>To avoid that switch off IPv6 or add a special route that prevents the system
from trying to use IPv6 with www.opensuse.org:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">ip -6 r a to unreachable <span class="tok-m">2620</span>:113:8044:66:130:57:66:6/128</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_openqa_users_guide" class="sect0">openQA users guide</h1>
<div class="sect1">
<h2 id="_introduction_3">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document provides additional information for use of the web interface or
the REST API as well as administration information.
For administrators it is recommend to have read the
<a href="Installing.asciidoc">installation guide</a> first to understand the structure
of components as well as the configuration of an installed instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_of_the_web_interface">Use of the web interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In general the web UI should be intuitive or self-explanatory. Look out for the
little blue help icons and click them for detailed help on specific sections.</p>
</div>
<div class="paragraph">
<p>Some pages use queries to select what should be shown. The query parameters are
generated on clickable links, for example starting from the index page or the
group overview page clicking on single builds. On the query pages there can be
UI elements to control the parameters, for example to look for more older
builds or only show failed jobs or other settings. Additionally, the query
parameters can be tweaked by hand if you want to provide a link to specific
views.</p>
</div>
<div class="sect2">
<h3 id="__tests_overview_customizable_test_overview_page">/tests/overview - Customizable test overview page</h3>
<div class="paragraph">
<p>The overview page is configurable by the filter box. Also, some additional
query parameters can be provided which can be considered advanced or
experimental. For example specifying no build will resolve the latest build
which matches the other parameters specified. Specifying no group will show
all jobs from all matching job groups. Also specifying multiple groups works,
see <a href="#overview_multiple_groups">the following example</a>.</p>
</div>
<div id="overview_multiple_groups" class="imageblock">
<div class="content">
<img src="images/tests-overview_multiple_groups.png" alt="test overview page showing multiple groups">
</div>
<div class="title">Figure 2. The openQA test overview page showing multiple groups at once. The URL query parameters specify the groupid parameter two times to resolve both the "opensuse" and "opensuse test" group.</div>
</div>
</div>
<div class="sect2">
<h3 id="_description_of_test_suites">Description of test suites</h3>
<div class="paragraph">
<p>Test suites can be described using API commands or the admin table for any operator using the web UI.</p>
</div>
<div id="test_suite_description_edit" class="imageblock">
<div class="content">
<img src="images/test_suite_description_edit.png" alt="test suite description edit field">
</div>
<div class="title">Figure 3. Entering a test suite description in the admin table using the web interface:</div>
</div>
<div class="paragraph">
<p>If a description is defined, the name of the test suite on the tests overview page shows up as a link. Clicking the link will show the description in a popup. The same syntax as for comments can be used, that is Markdown with custom extensions such as shortened links to ticket systems.</p>
</div>
<div id="test_suite_description_shown" class="imageblock">
<div class="content">
<img src="images/test_suite_description_shown.png" alt="test suite description popup">
</div>
<div class="title">Figure 4. popover in test overview with content as configured in the test suites database:</div>
</div>
</div>
<div class="sect2">
<h3 id="_review_badges">Review badges</h3>
<div class="paragraph">
<p>Based on comments in the individual job results for each build a certificate
icon is shown on the group overview page as well as the index page to indicate
that every failure has been reviewed, e.g. a bug reference or a test issue
reason is stated:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/review_badges.png" alt="Review badges">
</div>
</div>
<div class="sect3">
<h4 id="_meaning_of_the_different_colors">Meaning of the different colors</h4>
<div class="ulist">
<ul>
<li>
<p>The green icons shows up when there is no work to be done.</p>
</li>
<li>
<p>No icon is shown if at least one failure still need to be reviewed.</p>
</li>
<li>
<p>The gray icon is shown if at least one softfailure with failing modules still
need to be reviewed.</p>
</li>
<li>
<p>The black icon is shown if all review work has been done.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(To simplify, checking for false-negatives is not considered here.)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_tagging">Build tagging</h3>
<div class="sect3">
<h4 id="_tag_builds_with_special_comments_on_group_overview">Tag builds with special comments on group overview</h4>
<div class="paragraph">
<p>Based on comments on the group overview individual builds can be tagged. As
'build' by themselves do not own any data the job group is used to store this
information. A tag has a build to link it to a build. It also has a type
and an optional description. The type can later on be used to distinguish
tag types.</p>
</div>
<div class="paragraph">
<p>The generic format for tags is</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tag:&lt;build_id&gt;:&lt;type&gt;[:&lt;description&gt;], e.g. tag:1234:important:Beta1.</pre>
</div>
</div>
<div class="paragraph">
<p>The more recent tag always wins.</p>
</div>
<div class="paragraph">
<p>A 'tag' icon is shown next to tagged builds together with the description on
the group_overview page. The index page does not show tags by default to prevent
a potential performance regression. Tags can be enabled on the index page using the
corresponding option in the filter form at the bottom of the page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/build_tagging.png" alt="Example of a tag coment and corresponding tagged build">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keeping_important_builds">Keeping important builds</h4>
<div class="paragraph">
<p>As builds can now be tagged we come up with the convention that the
'important' type - the only one for now - is used to tag every job that
corresponds to a build as 'important' and keep the logs for these jobs longer so that
we can always refer to the attached data, e.g. for milestone builds, final
releases, jobs for which long-lasting bug reports exist, etc.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtering_test_results_and_builds">Filtering test results and builds</h3>
<div class="paragraph">
<p>At the top of the test results overview page is a form which allows filtering tests by result,
architecture and TODO-status.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/filter_form.png" alt="Filter form">
</div>
</div>
<div class="paragraph">
<p>There is also a similar form at the bottom of the index page which allows filtering builds by
group and customizing the limits.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting_job_dependencies_in_all_tests_table">Highlighting job dependencies in 'All tests' table</h3>
<div class="paragraph">
<p>When hovering over the branch icon after the test name children of the job will
be highlighted blue and parents red. So far this only works for jobs displayed on
the same page of the table.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/highlighting_job_dependencies.png" alt="highlighted child jobs">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_of_the_rest_api">Use of the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openQA includes a <em>client</em> script which - depending on the distribution - is
packaged independantly if you just want to interface with an existing openQA
instance without needing to install the full package. Call
<code>&lt;openqa-folder&gt;/script/client --help</code> for help (openSUSE: <code>openqa-client
--help</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_to_now_2">Where to now?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For test developers it is recommended to continue with the
<a href="WritingTests.asciidoc">Test Developer Guide</a>.</p>
</div>
</div>
</div>
<h1 id="_openqa_tests_developer_guide" class="sect0">openQA tests developer guide</h1>
<div class="sect1">
<h2 id="_introduction_4">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openQA is an automated test tool that makes it possible to test the whole
installation process of an operating system. It&#8217;s free software released
under the <a href="http://www.gnu.org/licenses/gpl-2.0.html">GPLv2 license</a>. The
source code and documentation are hosted in the
<a href="https://github.com/os-autoinst">os-autoinst organization on GitHub</a>.</p>
</div>
<div class="paragraph">
<p>This document provides the information needed to start developing new tests for
openQA or to improve the existing ones. It&#8217;s
assumed that the reader is already familiar with openQA and has already read the
Starter Guide, available at the
<a href="https://github.com/os-autoinst/openQA">official repository</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic">Basic</h2>
<div class="sectionbody">
<div id="basic" class="paragraph">
<p>This section explains the basic layout of openQA tests and the API available in tests.
openQA tests are written in the <strong>Perl</strong> programming language. Some basic but no
in-depth knowledge of Perl is needed. This document assumes that the reader
is already familiar with Perl.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api">API</h2>
<div class="sectionbody">
<div id="api" class="paragraph">
<p><a href="https://github.com/os-autoinst/os-autoinst/blob/master/testapi.pm">os-autoinst</a> provides the API for the tests using the os-autoinst backend, you can
take a look to the published documentation at <a href="http://open.qa/api/testapi/" class="bare">http://open.qa/api/testapi/</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_write_tests">How to write tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openQA tests need to implement at least the <strong>run</strong> subroutine to
contain the actual test code and the test needs to be loaded in the distribution&#8217;s
main.pm.</p>
</div>
<div class="paragraph">
<p>The <strong>test_flags</strong> subroutine specifies what happens when the test
fails.</p>
</div>
<div class="paragraph">
<p>There are several callbacks defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>post_fail_hook</strong> is called to upload log files or determine the state of
the machine</p>
</li>
<li>
<p><strong>pre_run_hook</strong> is called before the run function - mainly useful for a whole
group of tests</p>
</li>
<li>
<p><strong>post_run_hook</strong> is run after successful run function - mainly useful for a whole
group of tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example is a basic test that assumes some live image
that boots into the desktop when pressing enter at the boot loader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">use</span> <span class="tok-n">base</span> <span class="tok-s">&quot;basetest&quot;</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">strict</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">testapi</span><span class="tok-p">;</span>

<span class="tok-k">sub </span><span class="tok-nf">run</span> <span class="tok-p">{</span>
    <span class="tok-c1"># wait for bootloader to appear</span>
    <span class="tok-c1"># with a timeout explicitly lower than the default because</span>
    <span class="tok-c1"># the bootloader screen will timeout itself</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&quot;bootloader&quot;</span><span class="tok-p">,</span> <span class="tok-mi">15</span><span class="tok-p">;</span>

    <span class="tok-c1"># press enter to boot right away</span>
    <span class="tok-n">send_key</span> <span class="tok-s">&quot;ret&quot;</span><span class="tok-p">;</span>

    <span class="tok-c1"># wait for the desktop to appear</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&quot;desktop&quot;</span><span class="tok-p">,</span> <span class="tok-mi">300</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-k">sub </span><span class="tok-nf">test_flags</span> <span class="tok-p">{</span>
    <span class="tok-c1"># without anything - rollback to &#39;lastgood&#39; snapshot if failed</span>
    <span class="tok-c1"># &#39;fatal&#39; - abort whole test suite if this fails (and set overall state)</span>
    <span class="tok-c1"># &#39;milestone&#39; - after this test succeeds, update &#39;lastgood&#39;</span>
    <span class="tok-c1"># &#39;important&#39; - if this fails, set the overall state to &#39;failed&#39;</span>
    <span class="tok-k">return</span> <span class="tok-p">{</span> <span class="tok-n">important</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">1</span> <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-mi">1</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_test_case_examples">Test Case Examples</h3>
<div id="testcase_examples" class="listingblock">
<div class="title">Example: Console test that installs software from remote repository via zypper command</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">sub </span><span class="tok-nf">run</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-c1"># change to root</span>
    <span class="tok-n">become_root</span><span class="tok-p">;</span>

    <span class="tok-c1"># output zypper repos to the serial</span>
    <span class="tok-n">script_run</span> <span class="tok-s">&quot;zypper lr -d &gt; /dev/$serialdev&quot;</span><span class="tok-p">;</span>

    <span class="tok-c1"># install xdelta and check that the installation was successful</span>
    <span class="tok-n">assert_script_run</span> <span class="tok-s">&#39;zypper --gpg-auto-import-keys -n in xdelta&#39;</span><span class="tok-p">;</span>

    <span class="tok-c1"># additionally write a custom string to serial port for later checking</span>
    <span class="tok-n">script_run</span> <span class="tok-s">&quot;echo &#39;xdelta_installed&#39; &gt; /dev/$serialdev&quot;</span><span class="tok-p">;</span>

    <span class="tok-c1"># detecting whether &#39;xdelta_installed&#39; appears in the serial within 200 seconds</span>
    <span class="tok-nb">die</span> <span class="tok-s">&quot;we could not see expected output&quot;</span> <span class="tok-k">unless</span> <span class="tok-n">wait_serial</span> <span class="tok-s">&quot;xdelta_installed&quot;</span><span class="tok-p">,</span> <span class="tok-mi">200</span><span class="tok-p">;</span>

    <span class="tok-c1"># capture a screenshot and compare with needle &#39;test-zypper_in&#39;</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;test-zypper_in&#39;</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Typical X11 test testing kate</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">sub </span><span class="tok-nf">run</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-c1"># make sure kate was installed</span>
    <span class="tok-c1"># if not ensure_installed will try to install it</span>
    <span class="tok-n">ensure_installed</span> <span class="tok-s">&#39;kate&#39;</span><span class="tok-p">;</span>

    <span class="tok-c1"># start kate</span>
    <span class="tok-n">x11_start_program</span> <span class="tok-s">&#39;kate&#39;</span><span class="tok-p">;</span>

    <span class="tok-c1"># check that kate execution succeeded</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;kate-welcome_window&#39;</span><span class="tok-p">;</span>

    <span class="tok-c1"># close kate&#39;s welcome window and wait for the window to disappear before</span>
    <span class="tok-c1"># continuing</span>
    <span class="tok-n">wait_screen_change</span> <span class="tok-p">{</span> <span class="tok-n">send_key</span> <span class="tok-s">&#39;alt-c&#39;</span> <span class="tok-p">};</span>

    <span class="tok-c1"># typing a string in the editor window of kate</span>
    <span class="tok-n">type_string</span> <span class="tok-s">&quot;If you can see this text kate is working.\n&quot;</span><span class="tok-p">;</span>

    <span class="tok-c1"># check the result</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;kate-text_shown&#39;</span><span class="tok-p">;</span>

    <span class="tok-c1"># quit kate</span>
    <span class="tok-n">send_key</span> <span class="tok-s">&#39;ctrl-q&#39;</span><span class="tok-p">;</span>

    <span class="tok-c1"># make sure kate was closed</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;desktop&#39;</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_variables">Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Test case behavior can be controlled via variables. Some basic
variables like DISTRI, VERSION, ARCH are always set.
Others like DESKTOP are defined by the 'Test suites' in the openQA
web UI.
Check the existing tests at
<a href="https://github.com/os-autoinst/os-autoinst-distri-opensuse">os-autoinst-distri-opensuse
on GitHub</a> for examples.</p>
</div>
<div class="paragraph">
<p>Variables are accessible via the <strong>get_var</strong> and <strong>check_var</strong> functions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_development_tricks">Test Development tricks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_modifying_setting_of_an_existing_test">Modifying setting of an existing test</h3>
<div class="paragraph">
<p>There is no interface to modify existing tests but the clone_job.pl script
can be used to create a new job that adds, removes or changes
settings. This script is located at /usr/share/openqa/script/.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">/usr/share/openqa/script/clone_job.pl --from localhost --host localhost <span class="tok-m">42</span> <span class="tok-nv">FOO</span><span class="tok-o">=</span>bar <span class="tok-nv">BAZ</span><span class="tok-o">=</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not want a cloned job to start up in the same job group as the job
you cloned from, e.g. to not pollute build results you the job group can be
overwritten, too, using the special variable _GROUP. Add the quoted group
name, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">clone_job.pl --from localhost <span class="tok-m">42</span> <span class="tok-nv">_GROUP</span><span class="tok-o">=</span><span class="tok-s2">&quot;openSUSE Tumbleweed&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The special group value 0 means that the group connection will be separated
and the job will not appear as a job in any job group, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">clone_job.pl --from localhost <span class="tok-m">42</span> <span class="tok-nv">_GROUP</span><span class="tok-o">=</span><span class="tok-m">0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_snapshots_to_speed_up_development_of_tests">Using snapshots to speed up development of tests</h3>
<div id="snapshots" class="paragraph">
<p>Sometimes it&#8217;s annoying to run the full installation to adjust some
test. It would be nice to have the VM jump to a certain point. QEMU
backend provides feature that allows a job to start from a snapshot that might
help in this situation.</p>
</div>
<div class="paragraph">
<p>Depending on the use case, there are two options to help:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create and <strong>preserve</strong> snapshots for <strong>every test</strong> module run (MAKETESTSNAPSHOTS)</p>
<div class="ulist">
<ul>
<li>
<p>offers more flexibility as test can be resumed almost at any point, however
disk space requirements are high (expect more than 30GB for one job)</p>
</li>
<li>
<p>this mode is useful for fixing non fatal issues in tests and debugging SUT</p>
</li>
</ul>
</div>
</li>
<li>
<p>create snapshot <strong>after every successful</strong> test module, <strong>always overwrite</strong> to preserve only latest (TESTDEBUG)</p>
<div class="ulist">
<ul>
<li>
<p>allows to skip just before the start of first failed test module, which can be limiting, but there are
no additional hardware requirements.</p>
</li>
<li>
<p>this mode is useful for iterative test development</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both modes there is no need to modify tests (i.e. adding milestone test flag, it is implied).
In later mode, every test module is also considered fatal. This means the job is aborted after first failed test module.</p>
</div>
<div class="sect3">
<h4 id="_enable_snapshots_for_each_module">Enable snapshots for each module</h4>
<div class="ulist">
<ul>
<li>
<p>Run the worker with --no-cleanup parameter. This will preserve the hard
disks after test runs.</p>
</li>
<li>
<p>Set MAKETESTSNAPSHOTS=1 on a job. This will make openQA save a
snapshot for every test module run. One way to do that is by cloning an
existing job and adding the setting:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">clone_job.pl --from https://openqa.opensuse.org  --host localhost <span class="tok-m">24</span> <span class="tok-nv">MAKETESTSNAPSHOTS</span><span class="tok-o">=</span><span class="tok-m">1</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a job again, this time setting the SKIPTO variable to the snapshot you need. Again, clone_job.pl comes handy here:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">clone_job.pl --from https://openqa.opensuse.org  --host localhost <span class="tok-m">24</span> <span class="tok-nv">SKIPTO</span><span class="tok-o">=</span>consoletest-yast2_i</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use qemu-img snapshot -l something.img to find out what snapshots are in the image. Snapshots are named
<code>"test module category"-"test module name"</code> (e.g. <code>installation-start_install</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_storing_only_the_last_sucessfull_snapshot">Storing only the last sucessfull snapshot</h4>
<div class="ulist">
<ul>
<li>
<p>Run the worker with --no-cleanup parameter. This will preserve the hard disks after test runs.</p>
</li>
<li>
<p>Set TESTDEBUG=1 on a job. This will make openQA save a snapshot after each successful test module run. Snapshots are overwritten.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">clone_job.pl --from https://openqa.opensuse.org  --host localhost <span class="tok-m">24</span> <span class="tok-nv">TESTDEBUG</span><span class="tok-o">=</span><span class="tok-m">1</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a job again, this time setting the SKIPTO variable to the snapshot
which failed on previous run. If clone_job script is not used, TESTDEBUG=1
variable must be also included:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">clone_job.pl --from https://openqa.opensuse.org  --host localhost <span class="tok-m">24</span> <span class="tok-nv">TESTDEBUG</span><span class="tok-o">=</span><span class="tok-m">1</span> <span class="tok-nv">SKIPTO</span><span class="tok-o">=</span>consoletest-yast2_i</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assigning_jobs_to_workers">Assigning jobs to workers</h3>
<div class="paragraph">
<p>By default, any worker can get any job with the matching architecture.</p>
</div>
<div class="paragraph">
<p>This behavior can be changed by setting job variable WORKER_CLASS. Jobs
with this variable set (typically via machines or test suites configuration) are
assigned only to workers, which have the same variable in the configuration file.</p>
</div>
<div class="paragraph">
<p>For example, the following configuration ensures, that jobs with WORKER_CLASS=desktop
can be assigned <em>only</em> to worker instances 1 and 2.</p>
</div>
<div class="listingblock">
<div class="title">File: workers.ini</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-k">[1]</span>
<span class="tok-na">WORKER_CLASS</span> <span class="tok-o">=</span> <span class="tok-s">desktop</span>

<span class="tok-k">[2]</span>
<span class="tok-na">WORKER_CLASS</span> <span class="tok-o">=</span> <span class="tok-s">desktop</span>

<span class="tok-k">[3]</span>
<span class="tok-c1"># WORKER_CLASS is not set</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_multi_machine_tests">Writing multi-machine tests</h3>
<div id="mm-tests" class="paragraph">
<p>Scenarios requiring more than one system under test (SUT), like High Availability testing, are covered as multi-machine tests (MM tests) in this section.</p>
</div>
<div class="paragraph">
<p>OpenQA approaches multi-machine testing by assigning dependencies between individual jobs. This means the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>everything needed for MM tests must be running as a test job</em> (or you are on your own), even support infrastructure (custom DHCP, NFS,
etc. if required), which in principle is not part of the actual testing, must have a defined test suite so a test job can be created</p>
</li>
<li>
<p>OpenQA scheduler makes sure <em>tests are started as a group</em> and in right order, <em>cancelled as a group</em> if some dependencies are violated and <em>cloned as
a group</em> if requested.</p>
</li>
<li>
<p>OpenQA <em>does not synchronize</em> individual steps of the tests.</p>
</li>
<li>
<p>OpenQA provides <em>locking server for basic synchronization</em> of tests (e.g. wait until services are ready for failover), but the <em>correct usage of locks is
test designer job</em> (beware deadlocks).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In short, writing multi-machine tests adds a few more layers of complexity:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>documenting the dependencies and order between individual tests</p>
</li>
<li>
<p>synchronization between individual tests</p>
</li>
<li>
<p>actual technical realization (i.e. <a href="Networking.asciidoc">custom networking</a>)</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_job_dependencies">Job dependencies</h4>
<div class="paragraph">
<p>There are 2 types of dependencies: CHAINED and PARALLEL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CHAINED describes when one test case depends on another and both are run sequentially, i.e. KDE test suite is run after and only after Installation test suite
is successfully finished and cancelled if fail.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define CHAINED dependency add variable START_AFTER_TEST with the name(s) of test suite(s) after which selected test suite is supposed to run.
Use comma separated list for multiple test suite dependency. E.g. START_AFTER_TEST="kde,dhcp-server"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PARALLEL describes MM test, test suites are scheduled to run at the same time and managed as a group. On top of that, PARALLEL also describes
test suites dependencies, where some test suites (children) run parallel with other test suites (parents) only when parents are running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define PARALLEL dependency, use PARALLEL_WITH variable with the name(s) of test suite(s) which acts as a parent suite(s) to selected test suite.
In other words, PARALLEL_WITH describes "I need this test suite to be running during my run". Use comma separated list for multiple test suite dependency. E.g. PARALLEL_WITH="web-server,dhcp-server"
Keep in mind that parent job <em>must be running until all children finish</em>, else scheduler will cancel child jobs once parent is done.</p>
</div>
<div class="paragraph">
<p>Job dependencies are only resolved when using the iso controller to
create new jobs from job templates. Posting individual jobs manually
won&#8217;t work.</p>
</div>
<div class="paragraph">
<p>Job dependencies are currently only possible between tests that are
scheduled for the same machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_openqa_worker_requirements">OpenQA worker requirements</h4>
<div class="paragraph">
<p>CHAINED dependency requires only one worker, since dependent jobs will run only after the first one finish.
On the other hand PARALLEL dependency requires at <em>least 2 workers</em> for simple scenarios.</p>
</div>
<div class="sect4">
<h5 id="_examples">Examples:</h5>
<div class="listingblock">
<div class="title">Listing 1. CHAINED - i.e. test basic functionality before going advanced - requires 1 worker</div>
<div class="content">
<pre>A &lt;- B &lt;- C

Define test suite A,
then define B with variable START_AFTER_TEST=A and then define C with START_AFTER_TEST=B

-or-

Define test suite A, B
and then define C with START_AFTER_TEST=A,B
In this case however the start order of A and B is not specified.
But C will start only after A, B are successfully done.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 2. PARALLEL basic High-Availability</div>
<div class="content">
<pre>A
^
B

Define test suite A
and then define B with variable PARALLEL_WITH=A.
A in this case is parent test suite to B and must be running throughout B run.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 3. PARALLEL with multiple parents - i.e. complex support requirements for one test - requires 4 workers</div>
<div class="content">
<pre>A B C
\ | /
  ^
  D

Define test suites A,B,C
and then define D with PARALLEL_WITH=A,B,C.
A,B,C run in parallel and are parent test suites for D and all must run until D finish.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 4. PARALLEL with one parent - i.e. running independent tests against one server - requires at least 2 workers</div>
<div class="content">
<pre>   A
   ^
  /|\
 B C D

Define test suite A
and then define B,C,D with PARALLEL_WITH=A
A is parent test suite for B, C, D (all can run in parallel).
Children B, C, D can run and finish anytime, but A must run until all B, C, D finishes.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_synchronization_and_locking_api">Test synchronization and locking API</h3>
<div class="paragraph">
<p>OpenQA provides locking server through lock API. To use lock API import lockapi package (<em>use lockapi;</em>) in your test file.
Lock API provides three functions: mutex_create, mutex_lock, mutex_unlock. Each of these functions take one parameter: name of the lock.
Locks are associated with caller`s job - locks can&#8217;t be unlocked by different job then the one who locked the lock.</p>
</div>
<div class="paragraph">
<p>mutex_lock tries to lock the mutex lock for caller`s job. If lock is unavailable or locked by someone else, mutex_lock call blocks.</p>
</div>
<div class="paragraph">
<p>mutex_unlock tries to unlock the mutex lock. If lock is locked by different job, mutex_unlock call blocks. When lock become available or if lock does not exist, call
returns without doing anything.</p>
</div>
<div class="paragraph">
<p>mutex_create create new mutex lock. When lock is created by mutex_create,
 lock is automatically unlocked. When mutex lock already exists call returns without doing anything.</p>
</div>
<div class="paragraph">
<p>Locks are addressed by <em>their name</em>. This name is <em>valid in test group</em> defined by their dependencies. If there are more groups running at the
same time and the same lock name is used, these locks are independent of each other.</p>
</div>
<div class="paragraph">
<p>The mmapi package provides wait_for_children, which the parent can use to wait for the children to complete.</p>
</div>
<div class="exampleblock">
<div class="title">Example of mmapi: Parent JobWait until login prompt appear, assume services are started</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">use</span> <span class="tok-n">base</span> <span class="tok-s">&quot;basetest&quot;</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">strict</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">testapi</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">lockapi</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">mmapi</span><span class="tok-p">;</span>

<span class="tok-k">sub </span><span class="tok-nf">run</span> <span class="tok-p">{</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;bootloader&#39;</span><span class="tok-p">;</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;login&#39;</span><span class="tok-p">,</span> <span class="tok-mi">300</span><span class="tok-p">;</span>

    <span class="tok-c1"># services start automatically</span>
    <span class="tok-c1"># unlock by creating the lock</span>
    <span class="tok-n">mutex_create</span><span class="tok-p">(</span><span class="tok-s">&#39;services_ready&#39;</span><span class="tok-p">);</span>

    <span class="tok-c1"># wait until all children finish</span>
    <span class="tok-n">wait_for_children</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example of mmapi: Child jobCheck until parent is ready, then start testing services</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">use</span> <span class="tok-n">base</span> <span class="tok-s">&quot;basetest&quot;</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">strict</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">testapi</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">lockapi</span><span class="tok-p">;</span>

<span class="tok-k">sub </span><span class="tok-nf">run</span> <span class="tok-p">{</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;bootloader&#39;</span><span class="tok-p">;</span>
    <span class="tok-n">assert_screen</span> <span class="tok-s">&#39;login&#39;</span><span class="tok-p">,</span> <span class="tok-mi">300</span><span class="tok-p">;</span>

    <span class="tok-c1"># this blocks until lock is created then locks and immediately unlocks</span>
    <span class="tok-n">mutex_lock</span><span class="tok-p">(</span><span class="tok-s">&#39;services_ready&#39;</span><span class="tok-p">);</span>
    <span class="tok-n">mutex_unlock</span><span class="tok-p">(</span><span class="tok-s">&#39;services_ready&#39;</span><span class="tok-p">);</span>

    <span class="tok-c1"># login to continue</span>
    <span class="tok-n">type_string</span><span class="tok-p">(</span><span class="tok-s">&quot;root\n&quot;</span><span class="tok-p">);</span>
    <span class="tok-nb">sleep</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-n">type_string</span><span class="tok-p">(</span><span class="tok-s">&quot;secret\n&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Sometimes it is useful to let a parent wait for certain action on a child, for example to verify
server state after completed request. In this scenario the child creates
a mutex and the parent unlocks it.</p>
</div>
<div class="paragraph">
<p>The child can however die at any time. To prevent parent deadlock in this situation,
parent has to pass child ID as a second parameter to mutex_lock(). If a child job
with given ID already finished, mutex_lock() calls die.</p>
</div>
<div class="exampleblock">
<div class="title">Example of mmapi: Parent JobWait until the child reaches given point</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">use</span> <span class="tok-n">base</span> <span class="tok-s">&quot;basetest&quot;</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">strict</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">testapi</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">lockapi</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">mmapi</span><span class="tok-p">;</span>

<span class="tok-k">sub </span><span class="tok-nf">run</span> <span class="tok-p">{</span>
    <span class="tok-k">my</span> <span class="tok-nv">$children</span> <span class="tok-o">=</span> <span class="tok-n">get_children</span><span class="tok-p">();</span>

    <span class="tok-c1"># let&#39;s suppose there is only one child</span>
    <span class="tok-k">my</span> <span class="tok-nv">$child_id</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-nb">keys</span> <span class="tok-nv">%$children</span><span class="tok-p">)[</span><span class="tok-mi">0</span><span class="tok-p">];</span>

    <span class="tok-c1"># this blocks until lock is available and then does nothing</span>
    <span class="tok-n">mutex_unlock</span><span class="tok-p">(</span><span class="tok-s">&#39;child_reached_given_point&#39;</span><span class="tok-p">,</span> <span class="tok-nv">$child_id</span><span class="tok-p">);</span>

    <span class="tok-c1"># continue with the test</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Getting information about parents and children</p>
</div>
<div class="exampleblock">
<div class="title">Example of mmapi: Getting info about parents / children</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">use</span> <span class="tok-n">base</span> <span class="tok-s">&quot;basetest&quot;</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">strict</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">testapi</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">mmapi</span><span class="tok-p">;</span>

<span class="tok-k">sub </span><span class="tok-nf">run</span> <span class="tok-p">{</span>
    <span class="tok-c1"># returns a hash ref containing (id =&gt; state) for all children</span>
    <span class="tok-k">my</span> <span class="tok-nv">$children</span> <span class="tok-o">=</span> <span class="tok-n">get_children</span><span class="tok-p">();</span>

    <span class="tok-k">for</span> <span class="tok-k">my</span> <span class="tok-nv">$job_id</span> <span class="tok-p">(</span><span class="tok-nb">keys</span> <span class="tok-nv">%$children</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">print</span> <span class="tok-s">&quot;$job_id is cancelled\n&quot;</span> <span class="tok-k">if</span> <span class="tok-nv">$children</span><span class="tok-o">-&gt;</span><span class="tok-p">{</span><span class="tok-nv">$job_id</span><span class="tok-p">}</span> <span class="tok-ow">eq</span> <span class="tok-s">&#39;cancelled&#39;</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-c1"># returns an array with parent ids, all parents are in running state (see Job dependencies above)</span>
    <span class="tok-k">my</span> <span class="tok-nv">$parents</span> <span class="tok-o">=</span> <span class="tok-n">get_parents</span><span class="tok-p">();</span>

    <span class="tok-c1"># let&#39;s suppose there is only one parent</span>
    <span class="tok-k">my</span> <span class="tok-nv">$parent_id</span> <span class="tok-o">=</span> <span class="tok-nv">$parents</span><span class="tok-o">-&gt;</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>

    <span class="tok-c1"># any job id can be queried for details with get_job_info()</span>
    <span class="tok-c1"># it returns a hash ref containing these keys:</span>
    <span class="tok-c1">#   name priority state result worker_id</span>
    <span class="tok-c1">#   retry_avbl t_started t_finished test</span>
    <span class="tok-c1">#   group_id group settings</span>
    <span class="tok-k">my</span> <span class="tok-nv">$parent_info</span> <span class="tok-o">=</span> <span class="tok-n">get_job_info</span><span class="tok-p">(</span><span class="tok-nv">$parent_id</span><span class="tok-p">);</span>

    <span class="tok-c1"># it is possible to query variables set by openqa frontend,</span>
    <span class="tok-c1"># this does not work for variables set by backend or by the job at runtime</span>
    <span class="tok-k">my</span> <span class="tok-nv">$parent_name</span> <span class="tok-o">=</span> <span class="tok-nv">$parent_info</span><span class="tok-o">-&gt;</span><span class="tok-p">{</span><span class="tok-n">settings</span><span class="tok-p">}</span><span class="tok-o">-&gt;</span><span class="tok-p">{</span><span class="tok-n">NAME</span><span class="tok-p">}</span>
    <span class="tok-k">my</span> <span class="tok-nv">$parent_desktop</span> <span class="tok-o">=</span> <span class="tok-nv">$parent_info</span><span class="tok-o">-&gt;</span><span class="tok-p">{</span><span class="tok-n">settings</span><span class="tok-p">}</span><span class="tok-o">-&gt;</span><span class="tok-p">{</span><span class="tok-n">DESKTOP</span><span class="tok-p">}</span>
    <span class="tok-c1"># !!! this does not work, VNC is set by backend !!!</span>
    <span class="tok-c1"># my $parent_vnc = $parent_info-&gt;{settings}-&gt;{VNC}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_support_server_based_tests">Support Server based tests</h3>
<div class="paragraph">
<p>The idea is to have a dedicated "helper server" to allow advanced network based testing.</p>
</div>
<div class="paragraph">
<p>Support server takes advantage of the basic parallel setup as described in the previous section, with the support server being the parent test 'A' and the test needing it being the child test 'B'. This ensures that the test 'B' always have the support server available.</p>
</div>
<div class="sect3">
<h4 id="_preparing_the_supportserver">Preparing the supportserver:</h4>
<div class="paragraph">
<p>The support server image is created by calling a special test, based on the autoyast test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">/usr/share/openqa/script/client <span class="tok-nb">jobs</span> post <span class="tok-nv">DISTRI</span><span class="tok-o">=</span>opensuse <span class="tok-nv">VERSION</span><span class="tok-o">=</span><span class="tok-m">13</span>.2 <span class="tok-se">\</span>
    <span class="tok-nv">ISO</span><span class="tok-o">=</span>openSUSE-13.2-DVD-x86_64.iso  <span class="tok-nv">ARCH</span><span class="tok-o">=</span>x86_64 <span class="tok-nv">FLAVOR</span><span class="tok-o">=</span>Server-DVD <span class="tok-se">\</span>
    <span class="tok-nv">TEST</span><span class="tok-o">=</span>supportserver_generator <span class="tok-nv">MACHINE</span><span class="tok-o">=</span>64bit <span class="tok-nv">DESKTOP</span><span class="tok-o">=</span>textmode  <span class="tok-nv">INSTALLONLY</span><span class="tok-o">=</span><span class="tok-m">1</span> <span class="tok-se">\</span>
    <span class="tok-nv">AUTOYAST</span><span class="tok-o">=</span>supportserver/autoyast_supportserver.xml <span class="tok-nv">SUPPORT_SERVER_GENERATOR</span><span class="tok-o">=</span><span class="tok-m">1</span> <span class="tok-se">\</span>
    <span class="tok-nv">PUBLISH_HDD_1</span><span class="tok-o">=</span>supportserver.qcow2</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces qemu image 'supportserver.qcow2' that contains the supportserver. The 'autoyast_supportserver.xml'
should define correct user and password, as well as packages and the common configuration.</p>
</div>
<div class="paragraph">
<p>More specific role the supportserver should take is then selected when the server is run in the actual test scenario.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_supportserver">Using the supportserver:</h4>
<div class="paragraph">
<p>In the Test suites, the supportserver is defined by setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-na">HDD_1</span><span class="tok-o">=</span><span class="tok-s">supportserver.qcow2</span>
<span class="tok-na">SUPPORT_SERVER</span><span class="tok-o">=</span><span class="tok-s">1</span>
<span class="tok-na">SUPPORT_SERVER_ROLES</span><span class="tok-o">=</span><span class="tok-s">pxe,qemuproxy</span>
<span class="tok-na">WORKER_CLASS</span><span class="tok-o">=</span><span class="tok-s">server,qemu_autoyast_tap_64</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where the SUPPORT_SERVER_ROLES defines the specific role (see code in 'tests/support_server/setup.pm' for available roles and their definition), and
 HDD_1 variable must be the name of the supportserver image as defined via PUBLISH_HDD_1 variable during supportserver generation. If the support
server is based on older SUSE versions (opensuse 11.x, SLE11SP4..) it may also be needed to add HDDMODEL=virtio-blk. In case of qemu backend, one can
also use BOOTFROM=c, for faster boot directly from the HDD_1 image.</p>
</div>
<div class="paragraph">
<p>Then for the 'child' test using this supportserver, the following additional variable must be set:
PARALLEL_WITH=supportserver-pxe-tftp
where 'supportserver-pxe-tftp' is the name given to the supportserver in the test suites screen.
Once the tests are defined, they can be added to openQA in the usual way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">/usr/share/openqa/script/client isos post <span class="tok-nv">DISTRI</span><span class="tok-o">=</span>opensuse <span class="tok-nv">VERSION</span><span class="tok-o">=</span><span class="tok-m">13</span>.2 <span class="tok-se">\</span>
        <span class="tok-nv">ISO</span><span class="tok-o">=</span>openSUSE-13.2-DVD-x86_64.iso <span class="tok-nv">ARCH</span><span class="tok-o">=</span>x86_64 <span class="tok-nv">FLAVOR</span><span class="tok-o">=</span>Server-DVD</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the DISTRI, VERSION, FLAVOR and ARCH correspond to the job group containing the tests.
Note that the networking is provided by tap devices, so both jobs should run on machines defined by (apart from others) having NICTYPE=tap, WORKER_CLASS=qemu_autoyast_tap_64.</p>
</div>
<div class="exampleblock">
<div class="title">Example of Support Server: a simple tftp test</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s assume that we want to test tftp client operation. For this, we setup the supportserver as a tftp server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-na">HDD_1</span><span class="tok-o">=</span><span class="tok-s">supportserver.qcow2</span>
<span class="tok-na">SUPPORT_SERVER</span><span class="tok-o">=</span><span class="tok-s">1</span>
<span class="tok-na">SUPPORT_SERVER_ROLES</span><span class="tok-o">=</span><span class="tok-s">dhcp,tftp</span>
<span class="tok-na">WORKER_CLASS</span><span class="tok-o">=</span><span class="tok-s">server,qemu_autoyast_tap_64</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With a test-suites name supportserver-opensuse-tftp.</p>
</div>
<div class="paragraph">
<p>The actual test 'child' job, will then have to set PARALLEL_WITH=supportserver-opensuse-tftp, and also other variables according to the test requirements. For convenience, we have also started a dhcp server on the supportserver, but even without it, network could be set up manually by assigning a free ip address (e.g. 10.0.2.15) on the system of the test job.</p>
</div>
<div class="exampleblock">
<div class="title">Example of Support Server: The code in the *.pm module doing the actual tftp test could then look something like the example below</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">use</span> <span class="tok-n">strict</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">base</span> <span class="tok-s">&#39;basetest&#39;</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">testapi</span><span class="tok-p">;</span>

<span class="tok-k">sub </span><span class="tok-nf">run</span> <span class="tok-p">{</span>
  <span class="tok-k">my</span> <span class="tok-nv">$script</span><span class="tok-o">=</span><span class="tok-s">&quot;set -e -x\n&quot;</span><span class="tok-p">;</span>
  <span class="tok-nv">$script</span><span class="tok-o">.=</span><span class="tok-s">&quot;echo test &gt;test.txt\n&quot;</span><span class="tok-p">;</span>
  <span class="tok-nv">$script</span><span class="tok-o">.=</span><span class="tok-s">&quot;time tftp &quot;</span><span class="tok-o">.</span><span class="tok-nv">$server_ip</span><span class="tok-o">.</span><span class="tok-s">&quot; -c put test.txt test2.txt\n&quot;</span><span class="tok-p">;</span>
  <span class="tok-nv">$script</span><span class="tok-o">.=</span><span class="tok-s">&quot;time tftp &quot;</span><span class="tok-o">.</span><span class="tok-nv">$server_ip</span><span class="tok-o">.</span><span class="tok-s">&quot; -c get test2.txt\n&quot;</span><span class="tok-p">;</span>
  <span class="tok-nv">$script</span><span class="tok-o">.=</span><span class="tok-s">&quot;diff -u test.txt test2.txt\n&quot;</span><span class="tok-p">;</span>
  <span class="tok-n">script_output</span><span class="tok-p">(</span><span class="tok-nv">$script</span><span class="tok-p">);</span>

<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>assuming of course, that the tested machine was already set up with necessary infrastructure for tftp, e.g. network was set up, tftp rpm installed and tftp service started, etc. All of this could be conveniently achieved using the autoyast installation, as shown in the next section.</p>
</div>
<div class="exampleblock">
<div class="title">Example of Support Server: autoyast based tftp test</div>
<div class="content">
<div class="paragraph">
<p>Here we will use autoyast to setup the system of the test job and the os-autoinst autoyast testing infrastructure. For supportserver, this means using proxy to access qemu provided data, for dowloading autoyast profile and tftp verify script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-na">HDD_1</span><span class="tok-o">=</span><span class="tok-s">supportserver.qcow2</span>
<span class="tok-na">SUPPORT_SERVER</span><span class="tok-o">=</span><span class="tok-s">1</span>
<span class="tok-na">SUPPORT_SERVER_ROLES</span><span class="tok-o">=</span><span class="tok-s">pxe,qemuproxy</span>
<span class="tok-na">WORKER_CLASS</span><span class="tok-o">=</span><span class="tok-s">server,qemu_autoyast_tap_64</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual test 'child' job, will then be defined as :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span class="tok-na">AUTOYAST</span><span class="tok-o">=</span><span class="tok-s">autoyast_opensuse/opensuse_autoyast_tftp.xml</span>
<span class="tok-na">AUTOYAST_VERIFY</span><span class="tok-o">=</span><span class="tok-s">autoyast_opensuse/opensuse_autoyast_tftp.sh</span>
<span class="tok-na">DESKTOP</span><span class="tok-o">=</span><span class="tok-s">textmode</span>
<span class="tok-na">INSTALLONLY</span><span class="tok-o">=</span><span class="tok-s">1</span>
<span class="tok-na">PARALLEL_WITH</span><span class="tok-o">=</span><span class="tok-s">supportserver-opensuse-tftp</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>again assuming the support server&#8217;s name being supportserver-opensuse-tftp. Note that the pxe role already contains tftp and dhcp server role, since they are needed for the pxe boot to work.</p>
</div>
<div class="exampleblock">
<div class="title">Example of Support Server: The tftp test defined in the autoyast_opensuse/opensuse_autoyast_tftp.sh file could be something like:</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-nb">set</span> -e -x
<span class="tok-nb">echo</span> <span class="tok-nb">test</span> &gt;test.txt
<span class="tok-nb">time</span> tftp <span class="tok-c1">#SERVER_URL# -c put test.txt test2.txt</span>
<span class="tok-nb">time</span> tftp <span class="tok-c1">#SERVER_URL# -c get test2.txt</span>
diff -u test.txt test2.txt <span class="tok-o">&amp;&amp;</span> <span class="tok-nb">echo</span> <span class="tok-s2">&quot;AUTOYAST OK&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and the rest is done automatically, using already prepared test modules in tests/autoyast subdirectory.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_text_consoles_and_the_serial_terminal">Using text consoles and the serial terminal</h3>
<div class="paragraph">
<p>Typically the OS you are testing will boot into a graphical shell e.g. The
Gnome desktop environment. This is fine if you wish to test a program with a
GUI, but lets say you want to run some shell scripts then it is not so
convenient.</p>
</div>
<div class="paragraph">
<div class="title">To access a text based console or TTY, you can do something like the</div>
<p>following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-k">use</span> <span class="tok-mf">5.018</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">warnings</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">base</span> <span class="tok-s">&#39;opensusebasetest&#39;</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">testapi</span><span class="tok-p">;</span>
<span class="tok-k">use</span> <span class="tok-n">utils</span><span class="tok-p">;</span>

<span class="tok-k">sub </span><span class="tok-nf">run</span> <span class="tok-p">{</span>
    <span class="tok-n">wait_boot</span><span class="tok-p">;</span>  <span class="tok-c1"># Utility function defined by the SUSE distribution</span>
    <span class="tok-n">select_console</span> <span class="tok-s">&#39;root-console&#39;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-mi">1</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will select a text TTY and login as the root user (you could use
become_root instead in this case). Had select_console 'root-console' been
used before then it would just select the TTY. Now that we are on a text
console it is possible to run scripts and observe their output. Note that
root-console is defined by the distribution, but also that calls to
select_console can have far reaching consequences depending on what console
is being selected and what backend/architecture the SUT is using.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Running a script: Using the assert_script_run and script_output commands</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-n">assert_script_run</span><span class="tok-p">(</span><span class="tok-s">&#39;cd /proc&#39;</span><span class="tok-p">);</span>
<span class="tok-k">my</span> <span class="tok-nv">$cpuinfo</span> <span class="tok-o">=</span> <span class="tok-n">script_output</span><span class="tok-p">(</span><span class="tok-s">&#39;cat cpuinfo&#39;</span><span class="tok-p">);</span>
<span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-nv">$cpuinfo</span> <span class="tok-o">=~</span> <span class="tok-sr">m/avx2/</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-c1"># Do something which needs avx2</span>
<span class="tok-p">}</span>
<span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-c1"># Do some workaround</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it is usually not necessary to return text from the SUT to the test
module for processing and it is often faster to do the processing in a shell
script on the SUT. However you may find it more convenient, readable or
reliable to do it in the Perl test module.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The script_run and script_output commands are high level commands which
use type_string and wait_serial underneath. Sometimes you may wish to use
lower level commands which give you more control, but be warned that it may
also make your code less portable.</p>
</div>
<div class="sect3">
<h4 id="_using_a_serial_terminal">Using a serial terminal</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You need a QEMU version &gt;= 2.6.1 and to set the
VIRTIO_CONSOLE variable to 1 to use this with the QEMU backend.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Usually OpenQA controls the system under test using VNC. This allows the use
of both graphical and text based consoles. Key presses are sent individually
as VNC commands and output is returned in the form of screen images and text
output from the SUT&#8217;s serial port.</p>
</div>
<div class="paragraph">
<p>Sending key presses over VNC is very slow so for tests which send a lot of
text commands it is much faster to use a serial port for both sending and
receiving TTY commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-n">select_console</span><span class="tok-p">(</span><span class="tok-s">&#39;root-virtio-terminal&#39;</span><span class="tok-p">);</span>  <span class="tok-c1"># Selects a virtio based serial terminal</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Changing input and output to a serial terminal has the side effect of changing
where wait_serial reads output from. This will cause some distribution
specific utility functions to fail, however they can usually be fixed with the
is_serial_terminal API function. To find out more look at the
is_serial_terminal POD in testapi.pm.</p>
</div>
<div class="paragraph">
<p>Another consequence of moving to a serial terminal is that none of the needle
based commands will be available because there is no screen image to match
against.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_openqa_pitfalls" class="sect0">openQA pitfalls</h1>
<div class="sect1">
<h2 id="_needle_editing">Needle editing</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>If a new needle is created based on a failed test, the new needle
will not be listed in old tests.</p>
</li>
<li>
<p>If an existing needle is updated with a new image or different
areas, the old test will display the new needle which might be
confusing</p>
</li>
<li>
<p>If a needle is deleted, old tests may display an error when viewing
them in the web UI.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mixed_production_and_development_environment">Mixed production and development environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are few things to take into account when running a development version and
a packaged version of openqa:</p>
</div>
<div class="paragraph">
<p>If the setup for the development scenario involves sharing /var/lib/openqa,
it would be wise to have a shared group <em>openqa</em>, that will have write and execute
permissions over said directory, so that <em>geekotest</em> user and the normal development
user can share the environment without problems.</p>
</div>
<div class="paragraph">
<p>This approach will lead to a problem when the openqa package is updated, since the
directory permissions will be changed again, nothing a <code>chmod -R g+rwx /var/lib/openqa/</code>
and <code>chgrp -R openqa /var/lib/openqa</code> can not fix.</p>
</div>
</div>
</div>
<h1 id="_networking_in_openqa" class="sect0">Networking in OpenQA</h1>
<div class="openblock partintro">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This overview is valid only when using QEMU backend!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Which networking type to use is controlled by the <code>NICTYPE</code>
variable. If unset or empty <code>NICTYPE</code> defaults to user, ie qemu
user networking which requires no further configuration.</p>
</div>
<div class="paragraph">
<p>For more advanced setups or tests that require multiple jobs to be
in the same networking the <a href="#_tap_based_network">TAP</a> or <a href="#_vde_based_network">VDE</a> based modes can be used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qemu_user_networking">Qemu user networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With Qemu <a href="http://wiki.qemu.org/Documentation/Networking#User_Networking_.28SLIRP.29">user networking</a> each jobs gets it&#8217;s own isolated network with
TCP and UDP routed to the outside. DHCP is provided by qemu. The MAC address of
the machine can be controlled with the NICMAC variable. If not set, it&#8217;s
52:54:00:12:34:56.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tap_based_network">TAP based network</h2>
<div class="sectionbody">
<div class="paragraph">
<p>os-autoinst can connect qemu to TAP devices of the host system to
leverage advanced network setups provided by the host by setting NICTYPE=tap.</p>
</div>
<div class="paragraph">
<p>The TAP device to use can be configured with the TAPDEV variable. If not set
defined, ist&#8217;s automatically set to "tap" + ($worker_instance - 1), i.e.
worker1 uses tap0, worker 2 uses tap1 and so on.</p>
</div>
<div class="paragraph">
<p>For multiple networks per job (see NETWORKS variable), the following numbering
scheme is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">worker1: tap0 tap64 tap128 ...
worker2: tap1 tap65 tap129 ...
worker3: tap2 tap66 tap130 ...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>MAC address of virtual NIC is controlled by NICMAC variable or
automatically computed from $worker_id if not set.</p>
</div>
<div class="paragraph">
<p>In TAP mode the system administrator is expected to configure the
network, required internet access etc on the host manually.</p>
</div>
<div class="paragraph">
<p>TAP devices need be owned by the _openqa-worker user for openQA to
be able to access them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">tunctl -u _openqa-worker -p -t tap0</code></pre>
</div>
</div>
<div class="paragraph">
<p>or Wicked way:</p>
</div>
<div class="listingblock">
<div class="title">File: /etc/sysconfig/network/ifcfg-tap0</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-nv">BOOTPROTO</span><span class="tok-o">=</span><span class="tok-s1">&#39;none&#39;</span>
<span class="tok-nv">IPADDR</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>
<span class="tok-nv">NETMASK</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>
<span class="tok-nv">PREFIXLEN</span><span class="tok-o">=</span><span class="tok-s1">&#39;&#39;</span>
<span class="tok-nv">STARTMODE</span><span class="tok-o">=</span><span class="tok-s1">&#39;auto&#39;</span>
<span class="tok-nv">TUNNEL</span><span class="tok-o">=</span><span class="tok-s1">&#39;tap&#39;</span>
<span class="tok-nv">TUNNEL_SET_GROUP</span><span class="tok-o">=</span><span class="tok-s1">&#39;nogroup&#39;</span>
<span class="tok-nv">TUNNEL_SET_OWNER</span><span class="tok-o">=</span><span class="tok-s1">&#39;_openqa-worker&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use TAP device which doesn&#8217;t exist on the system,
you need to set CAP_NET_ADMIN capability on qemu binary file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">zypper in libcap-progs
setcap <span class="tok-nv">CAP_NET_ADMIN</span><span class="tok-o">=</span>ep /usr/bin/qemu-system-x86_64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Network setup can be changed after qemu is started using network configure script
specified in TAPSCRIPT variable.</p>
</div>
<div class="paragraph">
<p>Sample script to add TAP device to existing bridge br0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">sudo brctl addif br0 <span class="tok-nv">$1</span>
sudo ip link <span class="tok-nb">set</span> <span class="tok-nv">$1</span> up</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tap_with_open_vswitch">TAP with Open vSwitch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The recomended way to configure the network for TAP devices is using Open vSwitch.
There is a support service os-autoinst-openvswitch.service which sets vlan number
of Open vSwitch ports based on NICVLAN variable - this separates the groups of
tests from each other.</p>
</div>
<div class="paragraph">
<p>NICVLAN variable is dynamically assigned by OpenQA scheduler.</p>
</div>
<div class="paragraph">
<p>Compared to VDE setup discussed later, Open vSwitch is more complicated to configure,
but provides more robust and scalable network.</p>
</div>
<div class="paragraph">
<p>Start Open vSwitch and add TAP devices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># start openvswitch.service</span>
systemctl start openvswitch.service
systemctl <span class="tok-nb">enable</span> openvswitch.service

<span class="tok-c1"># create bridge</span>
ovs-vsctl add-br br0

<span class="tok-c1"># add tap devices, use vlan 999 by default, the vlan number is supposed to be changed when the vm starts</span>
ovs-vsctl add-port br0 tap0 <span class="tok-nv">tag</span><span class="tok-o">=</span><span class="tok-m">999</span>
ovs-vsctl add-port br0 tap1 <span class="tok-nv">tag</span><span class="tok-o">=</span><span class="tok-m">999</span>
ovs-vsctl add-port br0 tap2 <span class="tok-nv">tag</span><span class="tok-o">=</span><span class="tok-m">999</span>
ovs-vsctl add-port br0 tap3 <span class="tok-nv">tag</span><span class="tok-o">=</span><span class="tok-m">999</span>
ovs-vsctl add-port br0 tap4 <span class="tok-nv">tag</span><span class="tok-o">=</span><span class="tok-m">999</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the workers with TAP capability are spread across multiple hosts, the network must be connected.
See Open vSwitch <a href="http://openvswitch.org/support/config-cookbooks/port-tunneling/">documentation</a> for details.</p>
</div>
<div class="paragraph">
<p>Example configuration of GRE tunnel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">ovs-vsctl add-port br0 gre0 -- <span class="tok-nb">set</span> interface gre0 <span class="tok-nv">type</span><span class="tok-o">=</span>gre options:remote_ip<span class="tok-o">=</span>&lt;IP address of other host&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The virtual machines need access to os-autoinst webserver acessible
via IP 10.0.2.2. The IP addresses of VMs are controlled by tests
and are likely to conflict if more independent tests runs in parallel.</p>
</div>
<div class="paragraph">
<p>The VMs have unique MAC that differs in the last 16 bits (see /usr/lib/os-autoinst/backend/qemu.pm).</p>
</div>
<div class="paragraph">
<p><code>os-autoinst-openvswitch.service</code> sets up filtering rules for the following translation scheme which
provide non-conflicting addresses visible from host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">MAC <span class="tok-m">52</span>:54:00:12:XX:YY -&gt; IP <span class="tok-m">10</span>.1.XX.YY</code></pre>
</div>
</div>
<div class="paragraph">
<p>That means that the local port of the bridge must be configured to IP 10.0.2.2
and netmask /15 that covers 10.0.0.0 and 10.1.0.0 ranges.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">ip addr add <span class="tok-m">10</span>.0.2.2/15 dev br0
ip route add <span class="tok-m">10</span>.0.0.0/15 dev br0
ip link <span class="tok-nb">set</span> br0 up</code></pre>
</div>
</div>
<div class="paragraph">
<p>and permanently in /etc/sysconfig/network</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># /etc/sysconfig/network/ifcfg-br0</span>
<span class="tok-nv">BOOTPROTO</span><span class="tok-o">=</span><span class="tok-s1">&#39;static&#39;</span>
<span class="tok-nv">IPADDR</span><span class="tok-o">=</span><span class="tok-s1">&#39;10.0.2.2/15&#39;</span>
<span class="tok-nv">STARTMODE</span><span class="tok-o">=</span><span class="tok-s1">&#39;auto&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>wicked 0.6.23 and later has enhanced support for the creation and configuration of OpenvSwitch bridges.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In some cases (e.g. on Leap) can be needed to start the OpenvSwitch service before the Network service by modifying the OpenvSwitch service. For reference see <a href="https://en.opensuse.org/Portal:Wicked/OpenvSwitch#Wicked_0.6.23.2B">this</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The permanent configuration for wicked 0.6.23 and later should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># /etc/sysconfig/network/ifcfg-br0</span>
<span class="tok-nv">BOOTPROTO</span><span class="tok-o">=</span><span class="tok-s1">&#39;static&#39;</span>
<span class="tok-nv">IPADDR</span><span class="tok-o">=</span><span class="tok-s1">&#39;10.0.2.2/15&#39;</span>
<span class="tok-nv">STARTMODE</span><span class="tok-o">=</span><span class="tok-s1">&#39;auto&#39;</span>
<span class="tok-nv">OVS_BRIDGE</span><span class="tok-o">=</span><span class="tok-s1">&#39;yes&#39;</span>
<span class="tok-nv">OVS_BRIDGE_PORT_DEVICE_1</span><span class="tok-o">=</span><span class="tok-s1">&#39;tap0&#39;</span>
<span class="tok-nv">OVS_BRIDGE_PORT_DEVICE_2</span><span class="tok-o">=</span><span class="tok-s1">&#39;tap1&#39;</span>
<span class="tok-nv">OVS_BRIDGE_PORT_DEVICE_3</span><span class="tok-o">=</span><span class="tok-s1">&#39;tap2&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The IP 10.0.2.2 can also serve as a gateway to access outside
network. For this, a NAT between br0 and eth0 must be configured
with SuSEfirewall or iptables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-c1"># configuration options for NAT with SuSEfirewall</span>
<span class="tok-c1"># /etc/sysconfig/SuSEfirewall</span>

<span class="tok-nv">FW_ROUTE</span><span class="tok-o">=</span><span class="tok-s2">&quot;yes&quot;</span>
<span class="tok-nv">FW_MASQUERADE</span><span class="tok-o">=</span><span class="tok-s2">&quot;yes&quot;</span>
<span class="tok-nv">FW_DEV_INT</span><span class="tok-o">=</span><span class="tok-s2">&quot;br0&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then it is possible to start the os-autoinst-openvswitch.service
The service uses br0 by default. It can be configured for another
bridge name by setting /etc/sysconfig/os-autoinst-openvswitch</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-nv">OS_AUTOINST_USE_BRIDGE</span><span class="tok-o">=</span>bridge_name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, start the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">systemctl start os-autoinst-openvswitch.service
systemctl <span class="tok-nb">enable</span> os-autoinst-openvswitch.service</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_open_vswitch_configuration">Debugging Open vSwitch configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Boot sequence with wicked &lt; 0.6.23:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>wicked - creates tap devices</p>
</li>
<li>
<p>openvswitch - creates the bridge br0, adds tap devices to it</p>
</li>
<li>
<p>wicked handles br0 as hotplugged device, assignd the IP 10.0.2.2 to it, updates SuSEFirewall</p>
</li>
<li>
<p>os-autoinst-openvswitch - installs openflow rules, handles vlan assignment</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Boot sequence with wicked 0.6.23 and newer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>openvswitch</p>
</li>
<li>
<p>wicked - creates the bridge br0 and tap devices, add tap devices to the bridge,</p>
</li>
<li>
<p>SuSEFirewall</p>
</li>
<li>
<p>os-autoinst-openvswitch - installs openflow rules, handles vlan assignment</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configuration and operation can be checked by the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">ovs-vsctl show <span class="tok-c1"># shows the bridge br0, the tap devices are assigned to it</span>
ovs-ofctl dump-flows br0 <span class="tok-c1"># shows the rules installed by os-autoinst-openvswitch in table=0</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>packets from tapX to br0 create additional rules in table=1</p>
</li>
<li>
<p>packets from br0 to tapX increase packet counts in table=1</p>
</li>
<li>
<p>empty output indicates a problem with os-autoinst-openvswitch service</p>
</li>
<li>
<p>zero packet count or missing rules in table=1 indicate problem with tap devices</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">ipables -L -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>As long as the SUT has access to external network, there should be
nonzero packet count in the forward chain between br0 and external
interface.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vde_based_network">VDE Based Network</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Virtual Distributed Ethernet provides a software switch that runs in
user space. It allows to connect several qemu instances without
affecting the system&#8217;s network configuration.</p>
</div>
<div class="paragraph">
<p>The openQA workers need a vde_switch instance running. The workers
reconfigure the switch as needed by the job.</p>
</div>
<div class="sect2">
<h3 id="_basic_single_machine_tests">Basic, single machine tests</h3>
<div class="paragraph">
<p>To start with a basic configuration like qemu user mode networking,
create a machine with the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VDE_SOCKETDIR=/run/openqa</p>
</li>
<li>
<p>NICTYPE=vde</p>
</li>
<li>
<p>NICVLAN=0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Start switch and user mode networking:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">systemctl start openqa-vde_switch
systemctl start openqa-slirpvde</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this setting all jobs on the same host would be in the same
network share the same SLIRP instance though.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_machine_tests">Multi machine tests</h3>
<div class="paragraph">
<p>Create a machine like above but don&#8217;t set NICVLAN. openQA will
dynamically allocate a VLAN number for all jobs that have
dependencies between each other. By default this VLAN is private and
has no internet access. To enable user mode networking set
<code>VDE_USE_SLIRP=1</code> on one of the machines. The worker running the job
on such a machine will start slirpvde and put it in the correct VLAN
then.</p>
</div>
</div>
</div>
</div>
<h1 id="_openqa_developer_guide" class="sect0">openQA developer guide</h1>
<div class="sect1">
<h2 id="_introduction_5">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openQA is an automated test tool that makes it possible to test the whole
installation process of an operating system. It&#8217;s free software released
under the <a href="http://www.gnu.org/licenses/gpl-2.0.html">GPLv2 license</a>. The
source code and documentation are hosted in the
<a href="https://github.com/os-autoinst">os-autoinst organization on GitHub</a>.</p>
</div>
<div class="paragraph">
<p>This document provides the information needed to start contributing to the
openQA development improving the tool, fixing bugs and implementing new
features. For information about writing or improving openQA tests, refer to the
Tests Developer Guide. In both documents it&#8217;s assumed that the reader is already
familiar with openQA and has already read the Starter Guide. All those documents
are available at the
<a href="https://github.com/os-autoinst/openQA">official repository</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_guidelines">Development guidelines</h2>
<div class="sectionbody">
<div id="guidelines" class="paragraph">
<p>As mentioned, the central point of development is the
<a href="https://github.com/os-autoinst">os-autoinst organization on GitHub</a> where several
repositories can be found:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/os-autoinst/openQA">openQA</a> containing documentation,
server, worker and other support scripts.</p>
</li>
<li>
<p><a href="https://github.com/os-autoinst/os-autoinst">os-autoinst</a> with the standalone
test tool.</p>
</li>
<li>
<p><a href="https://github.com/os-autoinst/os-autoinst-distri-opensuse">os-autoinst-distri-opensuse</a>
containing the tests used in <a href="http://openqa.opensuse.org" class="bare">http://openqa.opensuse.org</a></p>
</li>
<li>
<p><a href="https://github.com/os-autoinst/os-autoinst-needles-opensuse">os-autoinst-needles-opensuse</a>
with the needles associated to the tests in the former repository.</p>
</li>
<li>
<p><a href="https://github.com/os-autoinst/os-autoinst-distri-example">os-autoinst-distri-example</a>
with an almost empty set of tests meant to be used to start writing tests (and
creating the corresponding needles) from scratch for a new operating system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As in most projects hosted on GitHub, pull request are always welcome and
are the right way to contribute improvements and fixes.</p>
</div>
<div class="sect2">
<h3 id="_rules_for_commits">Rules for commits</h3>
<div id="rules_for_commits" class="ulist">
<ul>
<li>
<p>Every commit is checked by <a href="https://travis-ci.org/travis">Travis CI</a> as soon as
you create a pull request but you <strong>should</strong> run the openQA tests locally,
i.e. before every commit call:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">./script/tidy</code></pre>
</div>
</div>
<div class="paragraph">
<p>to ensure your perl code changes are consistent with the style rules</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You <strong>may</strong> also run local tests on your machine or in your own development
environment to verify everything works as expected. Call:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">make <span class="tok-nb">test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>for unit and integration tests.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For git commit messages use the rules stated on
<a href="http://chris.beams.io/posts/git-commit/">How to Write a Git Commit Message</a> as
a reference</p>
</li>
<li>
<p>Every pull request is reviewed in a peer review to give feedback on possible
implications and how we can help each other to improve</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this is too much hassle for you feel free to provide incomplete pull
requests for consideration or create an issue with a code change proposal.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_involved_into_development">Getting involved into development</h2>
<div class="sectionbody">
<div id="getting_involved" class="paragraph">
<p>But developers willing to get really involved into the development of openQA or
people interested in following the always-changing roadmap should take a look
at the <a href="https://progress.opensuse.org/projects/openqav3">openQAv3 project</a> in
openSUSE&#8217;s project management tool. This Redmine instance is used to coordinate
the main development effort organizing the existing issues (bugs and desired
features) into 'target versions'.</p>
</div>
<div class="paragraph">
<p>Currently developers meet in IRC channel
<a href="irc://chat.freenode.net/opensuse-factory">#opensuse-factory</a> and in a daily
<a href="https://github.com/jangouts/jangouts">jangouts</a> call of the core developer team.</p>
</div>
<div class="paragraph">
<p>In addition to the ones representing development sprints, two other versions are
always open. <a href="https://progress.opensuse.org/versions/73">Easy hacks</a> lists issues
that are not specially urgent and that are considered to be easy to implement
by newcomers. Developers looking for a place to start contributing
are encouraged to simply go to that list and assign any open issue to themselves.
<a href="https://progress.opensuse.org/versions/90">Future improvements</a> groups features
that are in the developers' and users' wish list but that have little chances to be
addressed in the short term, either because the return of investment is not
worth it or because they are out of the current scope of the development.</p>
</div>
<div class="paragraph">
<p>openQA and os-autoinst repositories also include test suites aimed at preventing
bugs and regressions in the software. <a href="https://codecov.io/">codecov</a> is
configured in the repositories to encourage contributors to raise the tests
coverage with every commit and pull request. New features and bug fixes are
expected to be backed with the corresponding tests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technologies">Technologies</h2>
<div class="sectionbody">
<div id="technologies" class="paragraph">
<p>Everything in openQA, from os-autoinst to the web frontend and from the tests
to the support scripts is written in Perl. So having some basic knowledge
about that language is really desirable in order to understand and develop
openQA. Of course, in addition to bare Perl, several libraries and additional
tools are required. The easiest way to install all needed dependencies is
using the available os-autoinst and openQA packages, as described in the
Installation Guide.</p>
</div>
<div class="paragraph">
<p>In the case of os-autoinst, only a few <a href="http://www.cpan.org/">CPAN</a> modules are
required. Basically Carp::Always, Data::Dump. JSON and YAML. On the other
hand, several external tools are needed including
<a href="http://wiki.qemu.org/Main_Page">QEMU</a>,
<a href="https://code.google.com/p/tesseract-ocr/">Tesseract</a> and
<a href="http://optipng.sourceforge.net/">OptiPNG</a>. Last but not least, the
<a href="http://opencv.org/">OpenCV</a> library is the core of the openQA image matching
mechanism, so it must be available on the system.</p>
</div>
<div class="paragraph">
<p>The openQA package is built on top of Mojolicious, an excellent Perl framework
for web development that will be extremely familiar to developers coming from
other modern web frameworks like Sinatra and that have nice and comprehensive
documentation available at its <a href="http://mojolicio.us">home page</a>.</p>
</div>
<div class="paragraph">
<p>In addition to Mojolicious and its dependencies, several other CPAN modules are
required by the openQA package. For a full list of hard dependencies, see the
file DEPENDENCIES.txt at the root of the openQA repository. Some additional
modules could be required when using a database engine other than the default
SQLite.</p>
</div>
<div class="paragraph">
<p>As already mentioned, openQA relies on a database engine to store the
information. PostgreSQL, MySQL and SQLite3 are supported, with the latter being
the default option.</p>
</div>
<div class="paragraph">
<p>Lastly, png2theora (part of the <a href="http://www.theora.org/">Theora project</a>) is
used to create a video from the screenshots generated by os-autoinst.</p>
</div>
<div class="paragraph">
<p>As stated in the previous section, every feature implemented in both packages
should be backed by proper tests.
<a href="http://perldoc.perl.org/Test/More.html">Test::More</a> is used to implement those
tests. As usual, tests are located under the /t/ directory. In the openQA
package, one of the tests consists of a call to
<a href="http://perltidy.sourceforge.net/">Perltidy</a> to ensure that the contributed code
follows the most common Perl style conventions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_the_database">Managing the database</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_to_change_the_database_schema">How to change the database schema</h3>
<div class="paragraph">
<p>During the development process there are cases in which the database schema
needs to be changed. After modifying files in lib/OpenQA/Schema/Result
there are some steps that have to be followed so that new database instances
and upgrades include those changes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, you need to increase the database version number in the <code>$VERSION</code>
variable in the lib/OpenQA/Schema.pm file.
Note that it&#8217;s recommended to notify the other developers before doing so,
to synchronize in case there are more developers wanting to increase the
version number at the same time.</p>
</li>
<li>
<p>Then you need to generate the deployment files for new installations,
this is done by running ./script/initdb --prepare_init.</p>
</li>
<li>
<p>Afterwards you need to generate the deployment files for existing installations,
this is done by running ./script/upgradedb --prepare_upgrade.
After doing so, the directories dbicdh/$ENGINE/deploy/&lt;new version&gt; and
dbicdh/$ENGINE/upgrade/&lt;prev version&gt;-&lt;new version&gt; for SQLite and PosgreSQL
should have been created with some SQL files inside containing the statements to
initialize the schema and to upgrade from one version
to the next in the corresponding database engine.</p>
</li>
<li>
<p>And finally, you need to create the fixtures files. Under
dbicdh/_common/deploy, rename the directory of the (previous) latest version
to the new version and do the necessary changes (if any). Then, under
dbicdh/_common/upgrade create a &lt;prev_version&gt;-&lt;new_version&gt; directory and
put some files there with SQL statements that upgrade the fixtures. Usually a
diff from the previous version to the new one helps to see what has to be in
the upgrade file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above steps are executed in the developer&#8217;s system. Once openQA is
installed in a production server, you should run either
./script/initdb --init_database or ./script/upgradedb --upgrade_database
to actually create or upgrade a database.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_add_fixtures_to_the_database">How to add fixtures to the database</h3>
<div class="paragraph">
<p>Fixtures (initial data stored in tables at installation time) are stored
in files into the dbicdh/_common/deploy/_any/&lt;version&gt; and
dbicdh/_common/upgrade/&lt;prev_version&gt;-&lt;next_version&gt; directories.</p>
</div>
<div class="paragraph">
<p>You can create as many files as you want in each directory. These files contain
SQL statements that will be executed when initializing or upgrading a database.
Note that those files (and directories) have to be created manually and they
shouldn&#8217;t create a transaction, since each file is already automatically
executed in its own transaction (so that changes are rolled back if there&#8217;s any
problem) and sqlite doesn&#8217;t support nested transactions.</p>
</div>
<div class="paragraph">
<p>Executed SQL statements can be traced by setting the DBIC_TRACE environment
variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-nb">export</span> <span class="tok-nv">DBIC_TRACE</span><span class="tok-o">=</span><span class="tok-m">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_overwrite_config_files">How to overwrite config files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It can be necessary during development to change the config files in etc/.
For example you have to edit etc/openqa/database.ini to use another database.
Or to increase the log level it&#8217;s useful to set the loglevel to debug in
etc/openqa/openqa.ini.</p>
</div>
<div class="paragraph">
<p>To avoid these changes getting in your git workflow, copy them to a new
directory and set OPENQA_CONFIG in your shell setup files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">cp -ar etc/openqa etc/mine
<span class="tok-nb">export</span> <span class="tok-nv">OPENQA_CONFIG</span><span class="tok-o">=</span><span class="tok-nv">$PWD</span>/etc/mine</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that OPENQA_CONFIG points to the directory containing openqa.ini, database.ini,
client.conf and workers.ini.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_setup_postgresql_to_test_locally_with_production_data">How to setup PostgreSQL to test locally with production data</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install PosgreSQL - under openSUSE the following package are required:
postgresql-server postgresql-init</p>
</li>
<li>
<p>Start the server: systemctl start postgresql</p>
</li>
<li>
<p>The following steps need to be done by the user postgres: su - postgres</p>
</li>
<li>
<p>Create user: createuser your_username where your_username must be the same
as the UNIX user you start your local openQA instance with.</p>
</li>
<li>
<p>Create database: createdb -O your_username openqa</p>
</li>
<li>
<p>The next steps must be done by the user you start your local openQA instance with.</p>
</li>
<li>
<p>Import dump: pg_restore -c -d openqa path/to/dump</p>
</li>
<li>
<p>Configure openQA to use PostgreSQL as described in the section <a href="Installing.asciidoc#other-database-engines">Other database engines</a> of the installation guide.
User name and password are not required.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_new_authentication_module">Adding new authentication module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenQA comes with three authentication modules providing authentication methods:
OpenID, iChain and Fake (see <a href="Installing.asciidoc#user-authentication">User authentication</a>).</p>
</div>
<div class="paragraph">
<p>All authentication modules reside in lib/OpenQA/Auth directory. During
OpenQA start, [auth]/method section of /etc/openqa/openqa.ini is read and according
to its value (or default OpenID) OpenQA tries to require OpenQA::WebAPI::Auth::$method.
If successful, module for given method is imported or the OpenQA ends with error.</p>
</div>
<div class="paragraph">
<p>Each authentication module is expected to export auth_config,
auth_login and auth_logout functions. In case of request-response mechanism (as in
OpenID), auth_response is imported on demand.</p>
</div>
<div class="paragraph">
<p>Currently there is no login page because all implemented methods use either 3rd party
page or none.</p>
</div>
<div class="paragraph">
<p>Authentication module is expected to return HASH:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="perl"><span class="tok-nv">%res</span> <span class="tok-o">=</span> <span class="tok-p">(</span>
    <span class="tok-c1"># error = 1 signals auth error</span>
    <span class="tok-n">error</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">0</span><span class="tok-o">|</span><span class="tok-mi">1</span>
    <span class="tok-c1"># where to redirect the user</span>
    <span class="tok-n">redirect</span> <span class="tok-o">=&gt;</span> <span class="tok-s">&#39;&#39;</span>
<span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Authentication module is expected to create or update user entry in OpenQA database
after user validation. See included modules for inspiration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customize_base_directory">Customize base directory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to customize the openQA base directory by setting the environment
variable OPENQA_BASEDIR. The default value is /var/lib.</p>
</div>
</div>
</div>
<h1 id="_openqa_branding" class="sect0">openQA branding</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>You can alter the appearance of the openQA web UI to some extent through
the 'branding' mechanism. The 'branding' configuration setting in the
'global' section of /etc/openqa/openqa.ini specifies the branding to
use. It defaults to 'openSUSE', and openQA also includes the 'plain'
branding, which is - as its name suggests - plain and generic.</p>
</div>
<div class="paragraph">
<p>To create your own branding for openQA, you can create a subdirectory
of /usr/share/openqa/templates/branding (or wherever openQA is
installed). The subdirectory&#8217;s name will be the name of your branding.
You can copy the files from branding/openSUSE or branding/plain to
use as starting points, and adjust as necessary.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_web_ui_template">Web UI template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>openQA uses the <a href="http://mojolicio.us/">Mojolicious</a> framework&#8217;s templating
system; the branding files are included into the openQA templates at
various points. To see where each branding file is actually included,
you can search through the files in the templates tree for the text
include_branding. Anywhere that helper is called, the branding file
with the matching name is being included.</p>
</div>
<div class="paragraph">
<p>The branding files themselves are Mojolicious 'Embedded Perl' templates just
like the main template files. You can read the <a href="http://mojolicio.us/perldoc/Mojolicious/Guides/Rendering">Mojolicious Documentation</a> for help with the
format.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-30 14:59:19 UTC
</div>
</div>
</body>
</html>